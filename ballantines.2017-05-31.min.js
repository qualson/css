function rePayInduceClose(a){var b=$(a.target).parents(".re_pay_induce");$.ajax({url:URL+"/lesson/checkRepayInduce/"+_band.info.model.userId+"/"+_band.info.model.bandId,dataType:"json",type:"POST",success:function(a){b.hide()}})}function shortDate(a){var b=a.substring(0,4),c=a.substring(4,6),d=a.substring(6,9),e=new Date(Date.UTC(b,c,d,0,0,0)),f={weekday:"long",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return e.toLocaleTimeString("en-us",f),e.toString().split(" ")}function freeQuestionMove(){encodeURIComponent("https://pass.band.us/p/100000/course/premium"),encodeURIComponent("영어 첨삭 과외");if(!_band.info.model.userBandSupported){if("Android"===_band.info.model.userDevice)return alert("BAND 최신 버전으로 업데이트 해주세요."),!1;if("iOS"===_band.info.model.userDevice)return alert("iOS버전은 준비 중입니다. \n최대한 빠르게 업데이트 할 예정이니 조금만 기다려주세요."),!1;if(!_band.info.model.userDevice)return alert("사용 가능한 버전이 아닙니다."),!1}}function initCap(a){var a=a.substring(0,1).toUpperCase()+a.substring(1,a.length);return a}function postEmpty(a,b,c){raw_template=$("#empty-post").html(),template=Handlebars.compile(raw_template),htmlStr=template({text:a,img:b}),$("#"+c).html(htmlStr)}var bandJsHandler=window.bandJsHandler||{purchasePartnerProduct:function(a,b,c,d){windows.location.href="bandinapp://purchase/partnerProduct?productKey="+a+"&purchaseKey="+b+"&clientToken="+c+"&callbackFunction="+d}},band=window.band||{};band.Partners={_appVersionString:/\d[.\d]*/.exec((/band.*/gi.exec(navigator.userAgent)||["band/0.0.0"])[0])[0],_os:navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?"ios":"android",_supportVersionInfo:{goDirectToBand:{android:"4.4.1",ios:""},getAuthorizeUrl:{android:"4.2.0",ios:"4.2.1"},authorize:{android:"4.2.0",ios:"4.2.1"},purchasePartnerProduct:{android:"4.2.0",ios:"4.2.1"},runRecorder:{android:"4.2.0",ios:"4.2.1"}},_compareVersion:function(a,b){var c=a.split("."),d=b.split(".");for(i=0;i<3;i++){if(num=c[i]||0,anotherNum=d[i]||0,num>anotherNum)return 1;if(num<anotherNum)return-1}return 0},isSupported:function(a){return this._compareVersion(this._appVersionString,(this._supportVersionInfo[a]||{})[this._os]||"999")>=0},getAuthorizeUrl:function(a,b){return this.isSupported("getAuthorizeUrl")?"https://pass.band.us/p/authorize?client_id="+a+"&redirect_uri="+encodeURIComponent(b):null},authorize:function(a,b){return this.isSupported("authorize")?void(windows.location.href=getAuthorizeUrl(a,b)):!1},purchasePartnerProduct:function(a,b,c,d){return this.isSupported("purchasePartnerProduct")?void bandJsHandler.purchasePartnerProduct(a,b,c,d):!1},runRecorder:function(a,b,c){return this.isSupported("runRecorder")?void("ios"==this._os?window.location.href="bandinapp://record/band?view_url="+encodeURIComponent(a)+"&callback="+b+"&limit="+c:window.location.href="bandapp://open/record?view_url="+encodeURIComponent(a)+"&callback="+b+"&limit="+c):!1}};var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()},displace:function(a){if(a=a?a:"56109909",/Android/i.test(this.any()))window.location.href="bandapp://band/"+a;else{if(!/iPhone|iPad|iPod/i.test(isMobile.any()))return;window.location.href="bandapp://band/"+a}}};"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b}),Math.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)}).toUpperCase()};var Model={inherited:function(){},created:function(){this.records={},this.attributes={}},prototype:{init:function(){}},create:function(){var a=Object.create(this);return a.parent=this,a.prototype=a.fn=Object.create(this.prototype),a.created(),this.inherited(a),a},init:function(){var a=Object.create(this.prototype);return a.parent=this,a.init.apply(a,arguments),a},extend:function(a){jQuery.extend(this,a)},include:function(a){jQuery.extend(this.prototype,a)}};Model.records={},Model.include({newRecord:!0,init:function(a){a&&this.load(a),this.create()},load:function(a){for(var b in a)this[b]=a[b]},create:function(){this.id||(this.id=Math.guid()),this.newRecord=!1,this.parent.records[this.id]=this},save:function(){this.newRecord?this.create():this.update()},destroy:function(){delete this.parent.records[this.id]},update:function(){this.parent.records[this.id]=this},dup:function(){return jQuery.extend(!0,{},this)},attributes:function(){var a={};for(var b in this.parent.attributes){var c=this.parent.attributes[b];a[c]=this[c]}return a.id=this.id,a}}),Model.extend({find:function(a){var b=this.records[a];if(!b)throw"unknown record";return b.dup()},populate:function(a){for(var b={},c=[],d=0,e=a.length;e>d;d++){var b=this.init(a[d]);b.newRecord=this,this.records[b.id]=b,c.push(b)}return c}}),Model.LocalStorage={saveLocal:function(a){var b=[];for(var c in this.records)b.push(this.records[c].attributes());localStorage[a]=JSON.stringify(b)},loadLocal:function(a){var b=JSON.parse(localStorage[a]);return this.populate(b)}},Model.include({createRemote:function(a,b){$.post(a,this.attributes(),b)},updateRemote:function(a,b){$.ajax({url:a,data:this.attributes(),success:b,type:"PUT"})}});var BandModel=Model.create(),_band={};_band.info={init:function(){var a,b=_band.data,c=b.scheduledPostSet.postSet,d=b.scheduledPostSet.navigations,e="FREE"===b.scheduledPostSet.paymentType?b.freeQuestionType:void 0,f=b.statusTimeLog.hasOwnProperty("completeWritingInspection")?!0:void 0,g=!!b.hasOwnProperty("writingFeedback"),h=g?b.writingFeedback.check:!0,i=b.statusTimeLog.hasOwnProperty("completeSpeakingInspection")?!0:void 0,j=!!b.hasOwnProperty("speakingFeedback"),k=j?b.speakingFeedback.check:!0,l=b.hasOwnProperty("completeBand")?b.completeBand:!1,m=b.hasOwnProperty("liteSoldOutApproach")?b.liteSoldOutApproach:!1,n=b.hasOwnProperty("premiumSoldOutApproach")?b.premiumSoldOutApproach:!1,o=b.rePayInduce,p=b.checkRepayInduce;"object"!=typeof b.user&&(b.user={},b.user.id="",b.user.name="학습자",b.user.thumbnail="/dist/images/icon/none-profile.png",b.user.userLevel="레벨이 없어요."),a=/Android/i.test(isMobile.any())?"Android":/iPhone|iPad|iPod/i.test(isMobile.any())?"iOS":void 0,this.model=BandModel.init({user:b.user,userName:b.user.name,userThumbnail:b.user.thumbnail||"/dist/images/icon/none-profile.png",userLevel:b.user.userLevel,userId:b.user.id,userDevice:a,userBandSupported:band.Partners.isSupported("purchasePartnerProduct"),courseName:b.courseName,paymentType:b.scheduledPostSet.paymentType,freeQuestionType:e,lessonId:b.id,bandId:b.band.id,todayDate:b.todayDate,level:b.scheduledPostSet.level,scheduledPostSetId:b.scheduledPostSet.id,date:b.scheduledPostSet.date,mission:b.scheduledPostSet.postSet.mission,shortDate:b.shortDate,goTodayLesson:b.goTodayLesson,topicPostOpen:b.postOpen.topicPost,topicPostComplete:c.topicPost.complete,questionPostOpen:b.postOpen.questionPost,questionPostComplete:c.questionPost.complete,writingPostOpen:b.postOpen.writingPost,writingPostComplete:c.writingPost.complete,speakingPostOpen:b.postOpen.speakingPost,speakingPostComplete:c.speakingPost.complete,reviewPostOpen:b.postOpen.reviewPost,reviewPostComplete:c.review.complete,curriculum:b.curriculum,completeWritingInspection:f,writingFeedback:g,writingFeedbackCheck:h,completeSpeakingInspection:i,speakingFeedback:j,speakingFeedbackCheck:k,postIdx:1,drawerInfo:void 0,navigations:d,completeBand:l,liteSoldOutApproach:m,premiumSoldOutApproach:n,rePayInduce:o,checkRepayInduce:p})}},_band.topic={init:function(){var a=_band.data,b=a.scheduledPostSet.postSet,c=b.topicPost,d=c.media;b.isCurriculum=a.curriculum,this.model=BandModel.init({isComplete:_band.info.model.topicPostComplete,isCurriculum:_band.info.model.curriculum,questions:b,media:d,mediaType:d.mediaType,userAnswer:c.hasOwnProperty("userAnswer")?c.userAnswer:void 0})}},_band.questions={init:function(){var a=_band.data,b=a.scheduledPostSet.postSet,c=b.expression,d=b.questionPost.questions;this.model=BandModel.init({isComplete:_band.info.model.questionPostComplete,isCurriculum:_band.info.model.curriculum,expression:c,questions:d,useRadio:b.questionPost.useRadio,radio:b.questionPost.radio,radioUserName:b.questionPost.radioUserName,radioUserThumbnail:b.questionPost.radioUserThumbnail,voiceExamples:b.questionPost.voiceExamples})}},_band.writing={init:function(){var a=_band.data,b=a.scheduledPostSet.postSet.writingPost,c=b.questions,d=a.hasOwnProperty("answerSet")?a.answerSet:{},e=d.hasOwnProperty("writingAnswers")?d.writingAnswers:void 0,f=d.hasOwnProperty("writingDialogs")?d.writingDialogs:void 0,g=a.hasOwnProperty("writingCorrectionPolicy")?a.writingCorrectionPolicy:void 0,h={url:b.characterThumbnailUrl,name:b.characterName},i={name:_band.info.model.userName,url:_band.info.model.userThumbnail};this.model=BandModel.init({isComplete:_band.info.model.writingPostComplete,questions:c,feedBack:!a.hasOwnProperty("writingFeedback"),user:i,character:h,placeholder:b.guide,writingAnswers:e,writingDialogs:f,correctionPolicy:g,status:b.status,isCurriculum:_band.info.model.curriculum})}},_band.writingFeedback={init:function(){var a=_band.data,b=a.writingFeedback,c=a.hasOwnProperty("anotherUserWritingFeedback")?a.anotherUserWritingFeedback:void 0;this.model=BandModel.init({feedback:b,anotherFeedback:c,tutorGroup:a.tutorGroup})}},_band.answerSheetFeedback={init:function(){var a=_band.data.answerSheetFeedback;if(null!=a){var b=a?a.userAnswerSheet:void 0,c=a?a.addAnswerSheet:void 0;this.model=BandModel.init({userName:a.userName,userThumbnail:a.userThumbnail,userAnswer:a.userAnswer,inspectorName:a.inspectorName,inspectorThumbnail:a.inspectorThumbnail,description:a.description,pronunciations:a.pronunciations,stamp:a.stamp,userAnswerFeedback:b,addAnswerFeedback:c})}}},_band.speakingFeedback={init:function(){var a=_band.data,b=a.speakingFeedback,c=a.hasOwnProperty("anotherUserSpeakingFeedback")?a.anotherUserSpeakingFeedback:void 0;this.model=BandModel.init({feedback:b,anotherFeedback:c,tutorGroup:null!=a.speakingTutorGroup?a.speakingTutorGroup:a.tutorGroup})}},_band.speaking={init:function(){var a=_band.data,b=a.scheduledPostSet.postSet.speakingPost,c=b.questions,d=a.hasOwnProperty("answerSet")?a.answerSet:{},e=d.hasOwnProperty("speakingAnswers")?d.speakingAnswers:void 0,f=d.hasOwnProperty("speakingAnswers")?d.speakingAnswerText:void 0,g=d.hasOwnProperty("speakingDialogs")?d.speakingDialogs:void 0,h=a.hasOwnProperty("speakingCorrectionPolicy")?a.speakingCorrectionPolicy:void 0,i={url:b.characterThumbnailUrl,name:b.characterName},j={name:_band.info.model.userName,url:_band.info.model.userThumbnail};this.model=BandModel.init({isComplete:_band.info.model.speakingPostComplete,questions:c,feedBack:!a.hasOwnProperty("speakingFeedback"),user:j,character:i,placeholder:b.guide,speakingAnswers:e,speakingAnswerText:f,speakingDialogs:g,correctionPolicy:h,duration:b.recordLength,newCurriculum:b.newCurriculum,status:b.status,isCurriculum:_band.info.model.curriculum})}},_band.review={init:function(){var a=_band.data,b=a.scheduledPostSet.postSet.review.questions,c=a.hasOwnProperty("reviews")?a.reviews:[],d=a.hasOwnProperty("answerSet")&&a.answerSet.hasOwnProperty("reviewAnswers")?a.answerSet.reviewAnswers:[];this.model=BandModel.init({isComplete:_band.info.model.reviewPostComplete,questions:b,personalQs:c,answerSet:d})}},_band.drawInfo={init:function(){this.model=BandModel.init({postIndex:0,resolvedIndex:0})}};var view=view||{};view.freeCorrection={initialize:function(){var a=$(".timeBtn > li > a");this.img=$(".correctionBtn"),this.index=a.length-1;for(var b=0;b<a.length;b++)a.eq(b).data("index",b);a.off("click",$.proxy(this.imgOn,this)).on("click",$.proxy(this.imgOn,this))},imgOn:function(a){var b=$(a.currentTarget),c=this.img.attr("src");Number(b.data("index"))<this.index?"_off"!=c.match(/_off/)&&this.img.attr("src",c.replace("_on","_off")):"_off"==c.match(/_off/)&&this.img.attr("src",c.replace("_off","_on"))}},view.layout={model:void 0,init:function(a){this.model=this.model||_band.info.model,this.navigations=this.model.navigations,i,this.postType;_band.info.model.paymentType;for(i=0;i<this.navigations.length;i++)this.navigations[i].open=!0,this.navigations[i].pageType=this.setPageStatus(this.navigations[i].pageType),this.postType=this.navigations[i].postType,"topicPost"==this.postType&&(this.navigations[i].open=this.model.topicPostOpen,this.navigations[i].complete=this.model.topicPostComplete,this.navigations[i].emptyImg="empty_01.png",this.navigations[i].hasFeedback=!1),"questionPost"==this.postType&&(this.navigations[i].open=this.model.questionPostOpen,this.navigations[i].complete=this.model.questionPostComplete,this.navigations[i].emptyImg="empty_02.png",this.navigations[i].hasFeedback=!1),"writingPost"==this.postType&&(this.navigations[i].open=this.model.writingPostOpen,this.navigations[i].complete=this.model.writingPostComplete,this.navigations[i].emptyImg="empty_03.png",this.navigations[i].hasFeedback=this.model.completeWritingInspection&&!this.model.writingFeedbackCheck,_band.writing.order=this.navigations[i].order,"FREE"==_band.info.model.paymentType&&(this.navigations[i].emptyImg="empty_03_1.png",this.navigations[i].href="https://pass.band.us/p/100000/course/lite")),"speakingPost"==this.postType&&(this.navigations[i].open=this.model.speakingPostOpen,this.navigations[i].complete=this.model.speakingPostComplete,this.navigations[i].emptyImg="empty_04.png",this.navigations[i].hasFeedback=this.model.completeSpeakingInspection&&!this.model.speakingFeedbackCheck,_band.speaking.order=this.navigations[i].order,"FREE"==_band.info.model.paymentType&&(this.navigations[i].emptyImg="empty_04_1.png",this.navigations[i].href="https://pass.band.us/p/100000/course/premium")),"reviewPost"==this.postType&&(this.navigations[i].open=this.model.reviewPostOpen,this.navigations[i].complete=this.model.reviewPostComplete,this.navigations[i].emptyImg="empty_05.png",this.navigations[i].hasFeedback=!1),this.navigations[i].liteSoldOutApproach=this.model.liteSoldOutApproach,this.navigations[i].premiumSoldOutApproach=this.model.premiumSoldOutApproach;a&&(this.gnb(),this.postSection())},setPageStatus:function(a){var b,c=!1;return a.match(/NOT_YET_PAID/)&&(c=!0,b="NOT_YET_PAID"),a.match(/PASS_PAID/)&&(c=!0,b="PASS_PAID"),a.match(/NOT_YET_FREE/)&&(c=!0,b="NOT_YET_FREE"),a.match(/PASS_FREE/)&&(c=!0,b="PASS_FREE"),c?b:a},gnb:function(){var a,b,c,d=$("#gnb .timeBtn");a=$("#gnb-template").html(),b=Handlebars.compile(a),c=b({navi:this.navigations,purchase:"FREE"!==this.model.paymentType}),d.html(c)},postSection:function(){var a,b,c,d,e=_band.info.model.completeBand,f=$(".flicking");d="FREE"==_band.info.model.paymentType,a=$("#post-wraper-template").html(),b=Handlebars.compile(a),c=b({navi:this.navigations,isToday:this.model.today,freePayment:d,completeBand:e}),f.html(c),d&&view.freeCorrection.initialize()}},String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/,"")},String.prototype["byte"]=function(){for(var a=0,b=0;b<this.length;b++)this.charCodeAt(b)>127?a+=2:a++;return a},String.prototype["int"]=function(){return isNaN(this)?null:parseInt(this)},String.prototype.num=function(){return this.trim().replace(/[^0-9]/g,"")},String.prototype.money=function(){for(var a=this.trim();/(-?[0-9]+)([0-9]{3})/.test(a);)a=a.replace(/(-?[0-9]+)([0-9]{3})/,"$1,$2");return a},String.prototype.digits=function(a){var b="";if(this.length<a)for(var c=0;c<a-this.length;c++)b+="0";return b+this},String.prototype.quota=function(){return this.replace(/"/g,"&#34;").replace(/'/g,"&#39;")},String.prototype.ext=function(){return this.indexOf(".")<0?"":this.substring(this.lastIndexOf(".")+1,this.length)},String.prototype.uri=function(){var a=this.split("?");return a=a[0].split("#"),a[0]},String.prototype.meta=function(){for(var a=this,b="",c=0;c<a.length;c++)b+=/([\$\(\)\*\+\.\[\]\?\\\^\{\}\|]{1})/.test(a.charAt(c))?a.charAt(c).replace(/([\$\(\)\*\+\.\[\]\?\\\^\{\}\|]{1})/,"\\$1"):a.charAt(c);return b},String.prototype.remove=function(pattern){return null==pattern?this:eval("this.replace(/["+pattern.meta()+']/g, "")')},String.prototype.isLength=function(){var a=arguments[0],b=arguments[1]?arguments[1]:null,c=!0;return this.length<a&&(c=!1),b&&this.length>b&&(c=!1),c},String.prototype.isByteLength=function(){var a=arguments[0],b=arguments[1]?arguments[1]:null,c=!0;return this["byte"]()<a&&(c=!1),b&&this["byte"]()>b&&(c=!1),c},String.prototype.isBlank=function(){for(var a=this.trim(),b=0;b<a.length;b++)if("	"!=a.charAt(b)&&"\n"!=a.charAt(b)&&"\r"!=a.charAt(b))return!1;return!0},String.prototype.isNum=function(){return!!/^[0-9]+$/.test(this.remove(arguments[0]))},String.prototype.isEng=function(){return!!/^[a-zA-Z]+$/.test(this.remove(arguments[0]))},String.prototype.isEngNum=function(){return!!/^[0-9a-zA-Z]+$/.test(this.remove(arguments[0]))},String.prototype.isNumEng=function(){return this.isEngNum(arguments[0])},String.prototype.isUserid=function(){return!!/^[a-zA-z]{1}[0-9a-zA-Z]+$/.test(this.remove(arguments[0]))},String.prototype.isKor=function(){return!!/^[��-�R]+$/.test(this.remove(arguments[0]))},String.prototype.isJumin=function(){var arg=arguments[0]?arguments[0]:"",jumin=eval("this.match(/[0-9]{2}[01]{1}[0-9]{1}[0123]{1}[0-9]{1}"+arg+"[1234]{1}[0-9]{6}$/)");if(null==jumin)return!1;jumin=jumin.toString().num().toString();var birthYY=1==parseInt(jumin.charAt(6))?"19":"20";birthYY+=jumin.substr(0,2);var birthMM=jumin.substr(2,2)-1,birthDD=jumin.substr(4,2),birthDay=new Date(birthYY,birthMM,birthDD);if(birthDay.getYear()%100!=jumin.substr(0,2)||birthDay.getMonth()!=birthMM||birthDay.getDate()!=birthDD)return!1;for(var sum=0,num=[2,3,4,5,6,7,8,9,2,3,4,5],last=parseInt(jumin.charAt(12)),i=0;12>i;i++)sum+=parseInt(jumin.charAt(i))*num[i];return(11-sum%11)%10==last},String.prototype.isForeign=function(){var arg=arguments[0]?arguments[0]:"",jumin=eval("this.match(/[0-9]{2}[01]{1}[0-9]{1}[0123]{1}[0-9]{1}"+arg+"[5678]{1}[0-9]{1}[02468]{1}[0-9]{2}[6789]{1}[0-9]{1}$/)");if(null==jumin)return!1;jumin=jumin.toString().num().toString();var birthYY=5==parseInt(jumin.charAt(6))?"19":"20";birthYY+=jumin.substr(0,2);var birthMM=jumin.substr(2,2)-1,birthDD=jumin.substr(4,2),birthDay=new Date(birthYY,birthMM,birthDD);if(birthDay.getYear()%100!=jumin.substr(0,2)||birthDay.getMonth()!=birthMM||birthDay.getDate()!=birthDD)return!1;if((10*parseInt(jumin.charAt(7))+parseInt(jumin.charAt(8)))%2!=0)return!1;for(var sum=0,num=[2,3,4,5,6,7,8,9,2,3,4,5],last=parseInt(jumin.charAt(12)),i=0;12>i;i++)sum+=parseInt(jumin.charAt(i))*num[i];return(11-sum%11)%10+2==last},String.prototype.isBiznum=function(){var arg=arguments[0]?arguments[0]:"",biznum=eval("this.match(/[0-9]{3}"+arg+"[0-9]{2}"+arg+"[0-9]{5}$/)");if(null==biznum)return!1;biznum=biznum.toString().num().toString();for(var sum=parseInt(biznum.charAt(0)),num=[0,3,7,1,3,7,1,3],i=1;8>i;i++)sum+=parseInt(biznum.charAt(i))*num[i]%10;return sum+=Math.floor(5*parseInt(parseInt(biznum.charAt(8)))/10),sum+=5*parseInt(biznum.charAt(8))%10+parseInt(biznum.charAt(9)),sum%10==0},String.prototype.isCorpnum=function(){var arg=arguments[0]?arguments[0]:"",corpnum=eval("this.match(/[0-9]{6}"+arg+"[0-9]{7}$/)");if(null==corpnum)return!1;corpnum=corpnum.toString().num().toString();for(var sum=0,num=[1,2,1,2,1,2,1,2,1,2,1,2],last=parseInt(corpnum.charAt(12)),i=0;12>i;i++)sum+=parseInt(corpnum.charAt(i))*num[i];return(10-sum%10)%10==last},String.prototype.isEmail=function(){return/\w+([-+.]\w+)*@\w+([-.]\w+)*\.[a-zA-Z]{2,4}$/.test(this.trim())},String.prototype.isPhone=function(){var arg=arguments[0]?arguments[0]:"";return eval("(/(02|0[3-9]{1}[0-9]{1})"+arg+"[1-9]{1}[0-9]{2,3}"+arg+"[0-9]{4}$/).test(this)")},String.prototype.isMobile=function(){var arg=arguments[0]?arguments[0]:"";return eval("(/01[016789]"+arg+"[1-9]{1}[0-9]{2,3}"+arg+"[0-9]{4}$/).test(this)")},$.fn.qsFlicking=function(a){var b={btn:!1,dragPt:50,speed:100};return a&&$.extend(b,a),this.each(function(){var a={init:function(){this.infoModel=_band.info.model,this.cnt=0,this.obj=b.tar,this.ele=this.obj.find(">section"),this.btn=b.btn,this.nextBtn=$(".btn-next").not(".dialogShowBtn").not(".btn-correction"),this.dx=this.ele.eq(0).width(),this.dragPt=b.dragPt,this.speed=b.speed,this.bgObj=b.bg,this.bgSp=b.bgsp,this.bgWid,this.gap,this.objPoint,this.tPoint,this.tragFlag,this.completeShowTab=[],this.paymentType=this.infoModel.paymentType,this.completeBtn=$(".btn-complete"),this.dialogShowBtn=$(".dialogShowBtn").parent(),this.btnCorrection=$(".btn-correction").parent(),this.parentCon=$(".flickingWrap"),this.hash=window.location.hash.substring(1,2),this.bgObj&&this.bgObj.css({width:this.dx+this.dx*(this.ele.length-1)/this.bgSp});for(var a=0;a<this.btn.length;a++)this.btn.eq(a).data("idx",a);this.obj.css({left:this.cnt*this.dx*-1}),this.btn.eq(this.cnt).addClass("on"),this.hash&&this.hash<=this.ele.length&&(this.cnt=this.hash-1,_band.drawInfo.model.postIndex=this.cnt,this.obj.css({left:this.cnt*this.dx*-1}),this.btn&&(this.btn.removeClass("on"),this.btn.eq(this.cnt).addClass("on"))),$(window).on("hashchange",$.proxy(this.onHash,this)),$(window).resize($.proxy(this.reAlign,this)),this.btn&&this.btn.on("click",$.proxy(this.onTab,this)),$(".dynamicData").eq(this.cnt).trigger("renew");var c=this;this.ele.eq(this.cnt).find("img").load(function(){var a=c.ele.eq(c.cnt).outerHeight(!0);c.parentCon.height(a)}),_band.drawInfo.model.postIndex=this.cnt},reAlign:function(){this.dx=this.ele.eq(0).width(),this.obj.css({left:this.cnt*this.dx*-1}),this.bgObj&&this.bgObj.css({width:this.dx+this.dx*(this.ele.length-1)/this.bgSp})},onStart:function(a){return"mousedown"==a.type&&a.preventDefault(),this.tragFlag?!1:(this.objPoint=parseFloat(this.obj.css("left")),this.xPoint=a.originalEvent.touches?a.originalEvent.touches[0].pageX:a.pageX,this.yPoint=a.originalEvent.touches?a.originalEvent.touches[0].pageY:a.pageY,this.tragFlag=1,void a.stopPropagation())},onMove:function(a){if("mousemove"==a.type&&a.preventDefault(),this.tragFlag){var b=a.originalEvent.touches?a.originalEvent.touches[0].pageX:a.pageX,c=a.originalEvent.touches?a.originalEvent.touches[0].pageY:a.pageY;if(this.gap=b-this.xPoint,this.yGap=c-this.xPoint,this.yGap>5||this.yGap<-5)this.tragFlag=0;else{if(this.obj.css({left:this.objPoint+this.gap+"px"}),this.bgObj){var d=parseFloat((this.objPoint+this.gap)/this.bgSp);this.bgObj.css({left:d+"px"})}this.gap>5||this.gap<-5?a.preventDefault():this.obj.css({left:this.cnt*this.dx*-1})}}},onEnd:function(a){this.tragFlag&&("mouseup"==a.type&&a.preventDefault(),this.gap<-1*this.dragPt?(++this.cnt,$.proxy(this.motion(),this)):this.gap>this.dragPt?(--this.cnt,$.proxy(this.motion(),this)):$.proxy(this.motion(),this))},onTab:function(a){a.preventDefault(),audio.forcedStop(),this.cnt=$(a.currentTarget).data("idx"),this.tragFlag=1,a.preventDefault(),location.hash=this.cnt+1,_band.drawInfo.model.postIndex=this.cnt,view.layout.navigations[this.cnt].complete||(this.completeBtn.not(":eq("+this.cnt+")").hide(),this.completeBtn.removeClass("btn-complete-show").addClass("btn-complete-hide"),this.ele.eq(this.cnt).data("solvingEnd")&&("FREE"===this.paymentType?(this.completeBtn.hide(),this.completeBtn.parent().removeClass("btn-complete-show").addClass("btn-complete-hide")):(4==this.cnt?this.completeBtn.eq(2).show():this.completeBtn.eq(this.cnt).show(),this.completeBtn.parent().removeClass("btn-complete-hide").addClass("btn-complete-show"))))},motion:function(){var a=this;if(this.tragFlag){this.cnt<0&&(this.cnt=0),this.cnt>=this.ele.length&&(this.cnt=this.ele.length-1),this.obj.animate({left:this.cnt*this.dx*-1},this.speed,function(){a.tragFlag=0,a.gap=0,a.cnt>=a.ele.length?(a.cnt=0,a.obj.css({left:(a.cnt+1)*a.dx*-1})):a.cnt<0&&(a.cnt=a.ele.length-1,a.obj.css({left:(a.cnt+1)*a.dx*-1})),a.btn&&(a.btn.removeClass("on"),a.btn.eq(a.cnt).addClass("on"))}),this.bgObj&&this.bgObj.animate({left:parseFloat(this.cnt*this.dx*-1/this.bgSp)},this.speed,function(){a.tragFlag=0,a.gap=0,a.cnt>=a.ele.length?(a.cnt=0,a.obj.css({left:(a.cnt+1)*a.dx*-1})):a.cnt<0&&(a.cnt=a.ele.length-1,a.obj.css({left:(a.cnt+1)*a.dx*-1})),a.btn&&(a.btn.removeClass("on"),a.btn.eq(a.cnt).addClass("on"))}),_band.drawInfo.model.postIndex=this.cnt;var b=this.ele.eq(this.cnt).height();this.parentCon.height(b),scroll.gotoTop()}},onHash:function(a){this.hash=window.location.hash.substring(1,2),this.hash&&this.hash<=this.ele.length&&(this.cnt=this.hash-1,this.tragFlag=1,this.motion(),_band.drawInfo.model.postIndex=this.cnt)}};a.init()}),this};var audio={init:function(){var a=$("#speakingPost"),b=$(".audioWarp");b.find(".play"),b.find(".slow_play");this.target=null,this.loadingImg=$("#loadingImg"),this.flag=0,i=0,a.off("click",".play",$.proxy(this.audioPlay,this)).on("click",".play",$.proxy(this.audioPlay,this)),a.off("click",".slow_play",$.proxy(this.audioSlowPlay,this)).on("click",".slow_play",$.proxy(this.audioSlowPlay,this))},audioPlay:function(a){function b(){i.loadingImg.hide(),g.play(),i.flag=1}this.audioStop();var c,d,e,f,g=$(a.currentTarget).parents(".audioWarp").find("audio")[0],h=($(a.currentTarget).parents(".audioWarp").find("audio").eq(0),$(a.currentTarget).parents(".audioWarp").find("audio").eq(0).find("source").attr("src")),i=this;return g.volume=1,c="undefined"!=typeof g.error,d="undefined"!=typeof g.canplay,e="undefined"!=typeof g.ended,f="undefined"!=typeof g.play,h?(this.loadingImg.show(),d?g.addEventListener("canplay",function(){b()}):b(),g.addEventListener("ended",function(){i.flag=0}),void(this.target=g)):void alert("녹음 파일이 없습니다.")},audioSlowPlay:function(a){function b(){i.loadingImg.hide(),g.play(),i.flag=1}this.audioStop();var c,d,e,f,g=$(a.currentTarget).parents(".audioWarp").find("audio")[1],h=($(a.currentTarget).parents(".audioWarp").find("audio").eq(1),$(a.currentTarget).parents(".audioWarp").find("audio").eq(1).find("source").attr("src")),i=this;return g.volume=1,c="undefined"!=typeof g.error,d="undefined"!=typeof g.canplay,e="undefined"!=typeof g.ended,f="undefined"!=typeof g.play,h?(this.loadingImg.show(),d?g.addEventListener("canplay",function(){b()}):b(),g.addEventListener("ended",function(){i.flag=0}),void(this.target=g)):void alert("녹음 파일이 없습니다.")},audioStop:function(){return this.target?(this.target.pause(),this.target=null,void(this.flag=0)):!1},forcedStop:function(){return this.flag?(this.target.pause(),this.target=null,void(this.flag=0)):!1}},audioTextControl={init:function(){var a=$(".audioTextBtn");a.off("click",$.proxy(this.layerOn,this)).on("click",$.proxy(this.layerOn,this))},layerOn:function(a){var b=$(a.currentTarget).find("a"),c=$(a.currentTarget),d=$("#speaking_post");a.preventDefault(),b.hasClass("open")?(c.next().show(),b.text("스크립트 닫기"),b.removeClass("open").addClass("close")):(c.next().hide(),b.text("스크립트 열기"),b.removeClass("close").addClass("open")),$(".flickingWrap").height(d.height())}};$.fn.showModal=function(a){var b=this,c=this.find(".modal-dialog"),d=0,e=0,f=$("html");$(window).height();return b.removeClass("hide").addClass("show"),d=c.width(),e=c.height(),c.css({"margin-top":-(e/2),"margin-left":-(d/2)}),f.addClass("modalOn"),this},$.fn.hideModal=function(a){var b=$("html");return this.removeClass("show").addClass("hide"),b.removeClass("modalOn"),!1},$.fn.qsLangControl=function(a){var b={};a&&$.extend(b,a);return this.each(function(){var a={init:function(a){var b=$(".flicking");this.flag=0,b.off("click",".btn-ko-en",$.proxy(this.langChage,this)).on("click",".btn-ko-en",$.proxy(this.langChage,this))},langChage:function(a){var b,c,d,e=$(a.currentTarget).parents(".post-card");e.find(".btn-ko-en").length>1?(b=$(a.currentTarget).parents(".box"),c=$(b).find(".ko"),d=$(b).find(".eng")):(b=$(a.currentTarget).parents(".post-card"),c=$(b).find(".ko"),d=$(b).find(".eng")),"none"==c.css("display")?($(a.currentTarget).css("background-position","-28px top"),d.hide(),c.show()):($(a.currentTarget).css("background-position","left top"),d.show(),c.hide())}};a.init(this)}),this},$.fn.byteCheck=function(a){var b={};return a&&$.extend(b,a),this.each(function(){var a=this,c={init:function(){this.obj=$(a).find(b.obj),this.tar=$(a).find(b.tar),this.byteCheckOnly=b.byteCheckOnly||!1,this.maxCnt=b.maxCnt,this.flag=0,this.koFlag=0,this.txt,this.obj.on("focus",$.proxy(this.onFo,this)),this.obj.on("blur",$.proxy(this.onBl,this)),$(window).on("keyup",$.proxy(this.keyChek,this)),this.textarea,this.idx;for(var c=0;c<this.obj.length;c++)this.obj.eq(c).data("idx",c),this.tar.eq(c).data("idx",c)},onFo:function(a){this.flag=1,this.textarea=$(a.currentTarget),this.idx=this.textarea.data("idx")},onBl:function(a){this.flag=0},keyChek:function(a){return this.flag?void(this.byteCheckOnly?(this.txt=this.textarea.val(),this.btCheck()):this.koCheck()):!1},koCheck:function(a){for(var b=this.textarea.val(),c=/[^가-힣ㄱ-ㅎㅏ-ㅣ]/,d=0;d<b.length;d++)0==c.test(b.charAt(d))?(alert("영어로 입력해주세요"),this.koFlag=1,this.textarea.val(this.txt)):this.koFlag=0;this.koFlag||(this.txt=this.textarea.val(),this.btCheck())},btCheck:function(){this.txt.length>this.maxCnt&&(this.txt=this.txt.substring(0,this.maxCnt),this.tar.eq(this.idx).text(this.txt.length+"/"+this.maxCnt),this.obj.val(this.txt)),this.tar.eq(this.idx).text(this.txt.length+"/"+this.maxCnt)}};c.init()}),this};var scroll={init:function(){var a=_band.drawInfo.model,b=a.postIndex;this.resolvedIndex=a.resolvedIndex,this.dy=[],this.postCard=$(".flicking > section").eq(b).find(">div .post-card"),this.postCard.show();for(var c=0;c<this.postCard.length;c++)this.dy.push(this.postCard.eq(c).offset().top),c>this.resolvedIndex&&this.postCard.eq(c).hide()},gotoNext:function(){scroll.init();var a=this.postCard.eq(this.resolvedIndex),b=a.parent(),c=$(".flickingWrap"),d=$("body");a.show(),c.height(b.outerHeight(!0)),d.stop().animate({scrollTop:this.dy[this.resolvedIndex]})},gotoTop:function(a){var b=$("body");b.stop().animate({scrollTop:0})},gotoBottom:function(a){var b=$(window).height(),c=$(document).height(),d=$("body");d.stop().animate({scrollTop:c-b})},gotoTarget:function(a){var b=$(a),c=$("body");c.stop().animate({scrollTop:b.offset().top})}};$.fn.qsTimeLine=function(a){var b={btn:!1,dragPt:50,speed:100};return a&&$.extend(b,a),this.each(function(){var a={};a.init()}),this};var navControl={init:function(){this.visual=$(".visual"),this.postArea=$(".post-area"),this.gnbArea=this.postArea.find(".gnb-area"),this.postArea.on("scroll",$.proxy(this.scrollMove,this))},scrollDown:function(a){this.scrollMove(a)},scrollMove:function(a){0===this.postArea.scrollTop()?this.visual.removeClass("sm"):this.visual.hasClass("sm")||this.visual.addClass("sm")}},solution={init:function(){var a=$("button.hitBtn");a.data("display","none"),a.on("click",$.proxy(this.showBox,this))},showBox:function(a){var b,c=$(a.target);b=c.parent().hasClass("result")?["정답 닫기","정답 열기"]:c.parent().hasClass("koreanGuide")?["한글 해석 닫기","한글 해석 열기"]:["힌트 닫기","힌트 열기"],c.hasClass("close")?(c.next().hide(),c.text(b[1]),c.removeClass("close").addClass("open")):(c.next().show(),c.text(b[0]),c.removeClass("open").addClass("close")),$(".flickingWrap").height(c.parents("section").height())}},menuDrawer={init:function(a){var b=$(".drawer, .drawer-new"),c=$(".drawer-close");this.bg=$(".bg-shadow"),this.tar=$(".drawer-wrapper"),this.obj=$("#drawer"),this.obj.css({width:"100%",overflow:"hidden"}),this.data=a,this.flag=0,this.html=$("html"),b.on("click",$.proxy(this.show,this)),c.on("click",$.proxy(this.hide,this))},show:function(a){if(!this.flag){var b=this;this.flag=1,this.obj.show(),this.bg.show(),this.tar.animate({left:"20%"},"fast",function(){b.html.addClass("modalOn")})}},hide:function(a){if(this.flag){this.flag=0;
var b=this;this.tar.animate({left:"100%"},"fast",function(){b.obj.hide(),b.bg.hide(),b.html.removeClass("modalOn")})}}},disable={init:function(a){var b=a||null;return b?!1:void this.disablePost(a)},completionPost:function(a){var b=a.hasOwnProperty("currentTarget")?$(a.currentTarget).closest(".post-card"):a.find(".post-card");this.disablePost(b)},disablePost:function(a){for(var b=a.find(".userCorrect"),c=0;c<b.length;c++)"INPUT"==b[c].nodeName&&"text"==b.eq(c).attr("type")&&b.eq(c).attr({readonly:"readonly"}),"INPUT"==b[c].nodeName&&"radio"==b.eq(c).attr("type")&&b.eq(c).attr({disabled:!0}),"TEXTAREA"==b[c].nodeName&&b.eq(c).attr({readonly:"readonly"}).addClass("complete"),"BUTTON"==b[c].nodeName&&b.eq(c).off("click",$.proxy(view.questions.keepClass,view.questions))}};view.info={model:void 0,drawer:function(){function a(a){return"BEGINNING"==a?"1단계":"INTERMEDIATE"==a?"2단계":"HIGHER"==a?"3단계":"레벨이 없어요."}var b,c,d,e,f=$("#input-drawer");for(this.model=this.model||_band.info.model,b=0;b<this.model.drawerInfo.corrections.length;b++)this.model.drawerInfo.corrections[b].thumbnailFile||(this.model.drawerInfo.corrections[b].thumbnailFile="/dist/images/icon/none-profile.png");c=$("#drawer-temp").html(),d=Handlebars.compile(c),e=d({purchase:"FREE"!==this.model.paymentType,thumbnail:this.model.userThumbnail,name:this.model.userName,level:this.model.userLevel,drawerLevel:a(this.model.level),id:this.model.userId,bandId:this.model.bandId,courseName:this.model.courseName,drawerInfo:this.model.drawerInfo}),f.append(e),"FREE"!==this.model.paymentType&&f.find(".profile").addClass("on"),(this.model.completeWritingInspection&&!this.model.writingFeedbackCheck||this.model.completeSpeakingInspection&&!this.model.speakingFeedbackCheck)&&f.find(".btn").addClass("drawer-new")},todayMission:function(){this.model=this.model||_band.info.model;var a,b,c,d=this.model.date.substring(4,6),e=this.model.date.substring(6,9),f=this.model.shortDate,g=$("body"),h="BEGINNING"==this.model.level?1:"INTERMEDIATE"==this.model.level?2:3;a=$("#mission-template").html(),b=Handlebars.compile(a),c=b({mon:parseInt(d,10),day:parseInt(e,10),mission:this.model.mission,notToday:!this.model.today,level:parseInt(this.model.userLevel),goTodayLesson:this.model.goTodayLesson,curriculum:this.model.curriculum,step:h}),$(".today-mission").append(c),g.addClass(f),g.addClass(this.model.paymentType)},openPost:function(){_band.info.model.topicPostOpen?view.topic.init():_band.info.model.postIdx=1,_band.info.model.questionPostOpen?view.questions.init():_band.info.model.postIdx=2,_band.info.model.writingPostOpen?view.writing.init():_band.info.model.postIdx=3,_band.info.model.speakingPostOpen?view.speaking.init():"FREE"==_band.info.model.paymentType?_band.info.model.postIdx=2:_band.info.model.postIdx=4,_band.info.model.reviewPostOpen?view.review.init():(postEmpty(16,"reviewPost"),_band.info.model.postIdx=5),(_band.info.model.writingFeedback||"WRITING"===_band.info.model.freeQuestionType)&&(_band.writingFeedback.init(),view.writingFeedback.init()),(_band.info.model.speakingFeedback||"SPEAKING"===_band.info.model.freeQuestionType)&&(_band.speakingFeedback.init(),view.speakingFeedback.init())},compleatePost:function(){var a=view.info.model,b=$(".timeBtn li");a.topicPostComplete&&b.eq(0).find("i:first-child").addClass("complete"),a.questionPostComplete&&b.eq(1).find("i:first-child").addClass("complete"),a.writingPostComplete&&b.eq(2).find("i:first-child").addClass("complete"),a.speakingPostComplete&&b.eq(3).find("i:first-child").addClass("complete"),a.reviewPostComplete&&("LITE"==a.paymentType?b.eq(3).find("i:first-child").addClass("complete"):b.eq(4).find("i:first-child").addClass("complete"))},setCompleatePost:function(a){var b=view.info.model;b[a]=!0,view.layout.init(!1),this.compleatePost()},setModal:function(a){var b=a,c=$("#myModal"),d=c.find(".mission"),e=c.find(".complete"),f=c.find(".txt"),g=c.find(".txt2"),h=c.find(".lessonCheck > li"),i=_band.info.model.paymentType;d.html(b.title),e.text(b.subTitle),g.text(b.instruction),b.description?f.text(b.description):f.hide();for(var j=0;j<b.posts.length;j++)"LITE"===i&&j===b.posts.length-1&&(b.posts[j].lock||(h.eq(4).removeClass("time-closed").addClass("time-state"),b.posts[j].complete&&h.eq(4).removeClass("time-closed").addClass("done"))),b.posts[j].lock||(h.eq(j).removeClass("time-closed").addClass("time-state"),b.posts[j].complete&&h.eq(j).removeClass("time-closed").addClass("done"));c.showModal()},rePayInduce:function(){var a,b,c=view.info.model,d=$("body");if("NONE"!=c.rePayInduce&&!c.checkRepayInduce){a=$("#info_re_pay_induce").html(),template=Handlebars.compile(a),b=template({user:this.model.user,userId:this.model.userId,bandId:this.model.bandId,rePayInduce:this.model.rePayInduce}),$(".gnb-area").after(b);var e=d.find(".re_pay_induce"),f=e.find(".close_btn a");f.on("click",$.proxy(rePayInduceClose,this))}}},view.topic={model:void 0,init:function(){this.model=this.model||_band.topic.model;var a,b,c=$("#topicPost-template").html(),d=$("#topicPost"),e=Handlebars.compile(c),f=(e(),""),a=e(this.model.questions),f=a;null!=this.model.mediaType&&("VOICE"===this.model.mediaType&&(c=$("#tpVideoMedia").html(),e=Handlebars.compile(c),a=e({url:this.model.media.voiceUrl}),b=a),"PHOTO"===this.model.mediaType&&(c=$("#tpPhotoMedia").html(),e=Handlebars.compile(c),a=e({url:this.model.media.photoUrl}),b=a),"PHOTOS"===this.model.mediaType&&(c=$("#tpPhotosMedia").html(),e=Handlebars.compile(c),a=e(this.model.media.photoUrls),b=a),"TEXT"===this.model.mediaType&&(c=$("#tpTextMedia").html(),e=Handlebars.compile(c),a=e({engTxt:this.model.media.englishText,koTxt:this.model.media.koreanText}),b=a)),d.append(f),d.find(".topicMedia").append(b),d.byteCheck({obj:".txtBox",tar:".txtByte",maxCnt:150}),this.speakingBtn=d.find(".btn-speak"),this.speakingBtn.on("click",$.proxy(this.audioPlay,this)),this.model.isComplete?$.proxy(this.answer(),this):$.proxy(this.grading(),this)},audioPlay:function(a){var b=$(a.currentTarget).prev()[0];b.volume=1,b.play()},grading:function(){this.post=$("#topicPost"),this.postCard=this.post.find(".post-card"),this.nextBtn=this.post.find(".btn-next-q"),this.resolvedIdx=0,this.section=this.post.parent(),this.completeBtn=this.post.find(".btn"),this.submitBtn=$(".tpSubmit"),this.nextBtn.on("click",$.proxy(this.showNextQuestion,this)),this.completeBtn.on("click",$.proxy(this.showSubmit,this)),this.postCard.each(function(a,b){0!==a&&$(b).hide()})},answer:function(){var a=$("#topicPost"),b=this.model.userAnswer,c=a.find(".txtBox"),d=a.find(".post-card"),e=a.find(".btn-next-q"),f=a.find(".btn");e.hide(),f.hide(),c.val(b),disable.disablePost(d)},showNextQuestion:function(a){a.preventDefault(),this.postWraper=$(".flickingWrap"),this.resolvedIdx++,_band.drawInfo.model.resolvedIndex=this.resolvedIdx,scroll.gotoNext(),this.resolvedIdx+1===this.postCard.length&&(this.nextBtn.parent().hide(),this.nextBtn.off("click",this.showNextQuestion))},showSubmit:function(a){this.textAreaBox=this.post.find(".txtBox"),this.textAreaValue=this.textAreaBox.val(),this.textAreaValue?(this.submitBtn.parent().removeClass("btn-complete-show").addClass("btn-complete-hide"),this.section.data("solvingEnd",!0),this.completeBtn.hide(),this.submitBtn.show(),this.submitBtn.parent().removeClass("btn-complete-hide").addClass("btn-complete-show"),disable.completionPost(a),this.submitBtn.on("click",$.proxy(this.submit,this))):alert("작성한 글이 없습니다.\n작성 후 작성 완료 버튼을 눌러주세요")},submit:function(a){var b=_band.info.model,c=b.lessonId,d={},e=$("#loadingImg"),f=$("#trialToCharge"),g=this.completeBtn,h=this.submitBtn;return d.answer=this.textAreaValue,"FREE"===b.paymentType?(f.find(".trial-time").text("8"),f.showModal(),h.hide(),void view.info.setCompleatePost("topicPostComplete")):(e.show(),void $.ajax({url:URL+"/lesson/topicPost/"+c,dataType:"json",contentType:"application/json",data:JSON.stringify(d),type:"POST",success:function(a){e.hide(),"200"===a.code?(g.hide(),h.hide(),view.info.setCompleatePost("topicPostComplete"),view.info.setModal(a.result),scroll.gotoTop()):alert("전송실패\n다시 전송해주세요")}}))}},view.questions={model:void 0,init:function(){this.model=this.model||_band.questions.model,this.paymentType=_band.info.model.paymentType;var a,b,c,d,e,f="",g=$("#questionPost"),h=2,i=[];for(b=$("#remainPost").html(),c=Handlebars.compile(b),d=c({englishTitle:this.model.expression.englishTitle,koreanTitle:this.model.expression.koreanTitle,description:this.model.expression.description,example:this.model.expression.example,useRadio:this.model.useRadio,radio:this.model.radio,radioUserName:this.model.radioUserName,radioUserThumbnail:this.model.radioUserThumbnail,voiceExamples:this.model.voiceExamples,paymentType:this.paymentType,isCurriculum:_band.info.model.curriculum}),f+=d,a=0;a<this.model.questions.length;a++)"OX"!==this.model.questions[a].type&&"TF"!==this.model.questions[a].type||(b=$("#oxPost").html(),c=Handlebars.compile(b),d=c({id:this.model.questions[a].id,type:this.model.questions[a].type,order:"0"+h,translate:this.model.questions[a].translate,instruction:this.model.questions[a].instruction,englishText:this.model.questions[a].englishText,koreanText:this.model.questions[a].koreanText,answerResult:this.model.questions[a].answer.result,answerDes:this.model.questions[a].answer.description,userAnswer:this.model.questions[a].hasOwnProperty("userAnswer")?this.model.questions[a].userAnswer:"",isCurriculum:_band.info.model.curriculum}),f+=d),"OBJECTIVE"===this.model.questions[a].type&&(b=$("#objectivePost").html(),c=Handlebars.compile(b),d=c({id:this.model.questions[a].id,type:this.model.questions[a].type,order:"0"+h,translate:this.model.questions[a].translate,instruction:this.model.questions[a].instruction,optionItem:this.model.questions[a].options,answerResult:this.model.questions[a].answer.result,answerDes:this.model.questions[a].answer.description,userAnswer:this.model.questions[a].hasOwnProperty("userAnswer")?this.model.questions[a].userAnswer:"",isCurriculum:_band.info.model.curriculum}),f+=d),"SUBJECTIVE"===this.model.questions[a].type&&(b=$("#subjectivePost").html(),c=Handlebars.compile(b),d=c({id:this.model.questions[a].id,type:this.model.questions[a].type,order:"0"+h,translate:this.model.questions[a].translate,instruction:this.model.questions[a].instruction,blankedHTML:this.model.questions[a].blankedHtml,hint:this.model.questions[a].hint,answerResult:this.model.questions[a].answer.result,answerDes:this.model.questions[a].answer.description,userAnswer:this.model.questions[a].hasOwnProperty("userAnswer")?this.model.questions[a].userAnswer:"",right:this.model.questions[a].hasOwnProperty("right")?this.model.questions[a].right:"null",isCurriculum:_band.info.model.curriculum}),f+=d),"SHORT"===this.model.questions[a].type&&(b=$("#qtShort").html(),c=Handlebars.compile(b),d=c({id:this.model.questions[a].id,type:this.model.questions[a].type,order:"0"+h,title:"표현 익히기",translate:this.model.questions[a].translate,answerResult:this.model.questions[a].answer.result,answerDes:this.model.questions[a].answer.description,txt1:this.model.questions[a].texts[0]||"",txt2:this.model.questions[a].texts[1]||"",instruction:this.model.questions[a].instruction,userAnswer:this.model.questions[a].hasOwnProperty("userAnswer")?this.model.questions[a].userAnswer:"",isCurriculum:_band.info.model.curriculum}),f+=d),null!=this.model.questions[a].media.mediaType&&("VOICE"===this.model.questions[a].media.mediaType?(b=$("#qtVideoMedia").html(),c=Handlebars.compile(b),e=c({url:this.model.questions[a].media.voiceUrl})):"PHOTO"===this.model.questions[a].media.mediaType?(b=$("#qtphotoMedia").html(),c=Handlebars.compile(b),e=c({url:this.model.questions[a].media.photoUrl})):"TEXT"===this.model.questions[a].media.mediaType?(b=$("#qtTextMedia").html(),c=Handlebars.compile(b),e=c({engTxt:this.model.questions[a].media.englishText,koTxt:this.model.questions[a].media.koreanText})):e=void 0,i.push(e)),h++;g.append(f),g.find(".media").each(function(a){void 0!==i[a]&&$(this).append(i[a])}),g.byteCheck({obj:$(".txtBox"),tar:$(".txtByte"),maxCnt:150}),this.model.useRadio&&!_band.info.freeQuestionType&&(this.speechBtn=g.find(".btn-speak"),this.speechBtn.on("click",$.proxy(this.textToSpeech,this))),this.model.isComplete?$.proxy(this.answer(),this):$.proxy(this.grading(),this)},grading:function(){this.resolvedIdx=0,this.post=$("#questionPost"),this.section=this.post.parent(),this.postCard=this.post.find(".post-card"),this.postWraper=$(".flickingWrap"),this.button=this.post.find(".user-select-value"),this.radio=this.post.find('input[name^="am10"]'),this.inputTxt=this.post.find(".single-word"),this.textarea=this.post.find('div[id^="am10"] textarea'),this.completeCheck=this.post.find(".btn-icon-checked"),this.nextBtn=this.post.find(".btn-next-q"),this.submitBtn=$("#qt-submit"),this.btnOx=this.post.find(".btn-ox"),this.flagBtn=this.post.find(".btn-true-false"),this.completeCheck.on("click",$.proxy(this.userGrading,this)),this.nextBtn.on("click",$.proxy(this.showNextQuestion,this)),this.submitBtn.on("click",$.proxy(this.submit,this)),this.btnOx.on("click",$.proxy(this.keepClass,this)),this.flagBtn.on("click",$.proxy(this.keepClass,this));var a=0;for(a=0;a<this.postCard.length;a++)0!=a&&(this.postCard.eq(a).hide(),this.nextBtn.eq(a).parent().hide())},textToSpeech:function(a){var b=new Audio,c=$(a.target).prev();b.setAttribute("src",c.find("source").attr("src")),b.volume=1,b.load(),b.play()},keepClass:function(a){var b=$(a.currentTarget);b.parent().find(">button").removeClass("on"),b.addClass("on")},userGrading:function(a){a.preventDefault();var b,c=$(a.target).closest(".question"),d=c.next(),e=this.model.questions[this.resolvedIdx-1].type,f=c.find(".user-right"),g="",h="";if("OX"!==e&&"TF"!==e||(b=c.find(".user-select-value.on"),0!=b.length&&(h=b.attr("data-user-value").toLowerCase())),"OBJECTIVE"===e&&(b=c.find('input[name^="am10"]:checked'),0!=b.length&&(h=parseInt(b.attr("id").split("-")[4],10)+1)),"SUBJECTIVE"===e&&(b=c.find("textarea"),0!=b.length&&(h=b.val().toLowerCase().trim())),"SHORT"===e&&(b=c.find(".single-word"),0!=b.length&&(h=b.val().toLowerCase().trim())),c.attr("data-user-answer",h),g=c.attr("data-answer").toLowerCase().trim(),!h)return void alert("문제를 풀어 주세요!");if("SHORT"===e&&(h=h.replace(/ /g,""),g=g.match(/[a-zA-Z]+/g)[0],h=h.match(/[a-zA-Z]+/g)[0]),g==h?(f.eq(1).hide(),c.attr("data-user-right")||c.attr("data-user-right",!0)):(f.eq(0).hide(),c.attr("data-user-right")||c.attr("data-user-right",!1)),c.find(".result").show(),$(a.currentTarget).hide(),this.resolvedIdx!==this.postCard.length-1){d.show();var i=this;setTimeout(function(){$(".flickingWrap").height(i.post.height()+30)},500)}else this.submitBtn.parent().removeClass("btn-complete-show").addClass("btn-complete-hide"),this.section.data("solvingEnd",!0),this.submitBtn.show(),this.submitBtn.parent().removeClass("btn-complete-hide").addClass("btn-complete-show"),this.postWraper.height(this.post.height()+30),$(".btn-bottom").trigger("click");disable.completionPost(a)},showNextQuestion:function(a){a.preventDefault();var b,c;if(0!==this.resolvedIdx&&"SUBJECTIVE"===this.model.questions[this.resolvedIdx-1].type){if(b=this.postCard.eq(this.resolvedIdx),c=b.find(".user-select-value"),!c.hasClass("on"))return this.section.data("solvingEnd",!1),void alert("스스로 채점을 해주세요!");var d=b.find(".on").attr("data-user-value");"true"==d?b.attr("data-user-right",!0):b.attr("data-user-right",!1)}this.nextBtn.eq(this.resolvedIdx).parent().hide(),this.resolvedIdx++,_band.drawInfo.model.resolvedIndex=this.resolvedIdx,scroll.gotoNext(),this.resolvedIdx+1===this.postCard.length&&(this.nextBtn.parent().hide(),this.nextBtn.off("click",this.showNextQuestion))},qsValidation:function(){var a=[],b=!0;return this.post.find('div[id^="am10"]').each(function(c,d){var e,f=$(d);if(a.push({questionId:f.attr("data-qid"),answer:f.attr("data-user-answer"),right:f.attr("data-user-right")}),"SUBJECTIVE"===f.attr("data-type")){if(e=f.find(".on").attr("data-user-value"),f.attr("data-user-right",e),a[c].right=e,!f.find(".user-select-value").hasClass("on"))return f.closest("section").data("solvingEnd",!1),void(b=!1);f.closest("section").data("solvingEnd",!0),b=!0}}),b?this.answerInfo=a:alert("스스로 채점을 해주세요!"),b},submit:function(a){var b=_band.info.model,c=b.lessonId,d=$("#loadingImg"),e=$("#trialToCharge"),f=this.submitBtn;if(a.preventDefault(),this.qsValidation()){if("FREE"===b.paymentType)return e.find(".correction_go > img").attr("src","/dist/images/icon/correction_go_pop1.png"),e.showModal(),f.hide(),void view.info.setCompleatePost("questionPostComplete");d.show(),$.ajax({url:URL+"/lesson/questionPost/"+c,dataType:"json",contentType:"application/json",data:JSON.stringify(this.answerInfo),type:"POST",success:function(a){d.hide(),"200"===a.code?(f.hide(),view.info.setCompleatePost("questionPostComplete"),view.info.setModal(a.result),scroll.gotoTop()):alert("전송실패\n다시 전송해주세요")}})}},answer:function(){var a=$("#questionPost"),b=(this.model.answerSet,a.find(".btn-next-q")),c=a.find(".btn-icon-checked"),d=a.find(".question"),e=a.find(".result"),f=a.find(".post-card"),g=0;for(g=0;g<this.model.questions.length;g++){if("SHORT"==this.model.questions[g].type&&d.eq(g+1).find("input").attr({placeholder:this.model.questions[g].userAnswer,readonly:"readonly"}),"OBJECTIVE"==this.model.questions[g].type){var h=d.eq(g+1).find(".input-en").find("input");h.eq(Number(this.model.questions[g].userAnswer)-1).prop("checked","checked")}if("TF"==this.model.questions[g].type){var i=d.eq(g+1).find(".btn-group.align-center").eq(0).find("button");"true"==this.model.questions[g].userAnswer?i.eq(0).addClass("on"):i.eq(1).addClass("on")}if("SUBJECTIVE"==this.model.questions[g].type){var j=d.eq(g+1).find("textarea"),i=(d.eq(g+1).attr("data-answer"),d.eq(g+1).find(".btn-group.align-center").eq(1).find("button"));j.val(this.model.questions[g].userAnswer),j.attr("readonly","readonly").addClass("complete")}else"true"===this.model.questions[g].right?d.eq(g+1).find(".user-right").eq(1).hide():d.eq(g+1).find(".user-right").eq(0).hide();if("OX"==this.model.questions[g].type){var i=f.eq(g+1).find(".btn-group.align-center").eq(0).find("button");"o"==this.model.questions[g].userAnswer?i.eq(0).addClass("on"):i.eq(1).addClass("on")}}b.hide(),c.hide(),e.show(),a.find(".txtByte").remove(),disable.disablePost(a)}},view.writing={model:void 0,init:function(){this.model=this.model||_band.writing.model,this.totalCount=this.model.questions.length-1,this.questionCont=this.model.questions[this.totalCount].order,this.obj=$("#writingPost"),this.postParent=this.obj.parents("section"),this.waitContent=this.obj.find(".correction-wait"),this.questionData1=[],this.questionData2=[],this.korQuestion=[],this.engQuestion=[],this.korAnswer=[],this.engAnswer=[],this.userAnswer=null,this.count=1,this.nextLayer1=null,this.nextLayer2=null,this.nextLayer3=null,this.questionId1=null,this.questionId2=null,this.questionId3=null,this.userAnswerIndex1=null,this.userAnswerIndex2=null,this.userAnswerIndex3=null,this.submitFlag=0,this.submitData=[],this.model.isComplete?$.proxy(this.userAnswerFun(),this):$.proxy(this.isMultiple(),this)},multiple:function(){var a,b,c,d=(this.count,this.model),e=d.questions;if(1==this.count)a=$("#writing-template-card1").html(),b=Handlebars.compile(a),htmlStr=b({character:d.character,user:d.user,translate:e[0].translate,koTxt:e[0].media.koreanText,engTxt:e[0].media.englishText,optionItem:e[0].options,id:e[0].id,order:e[0].order,instruction:null==d.status?e[0].instruction:"상황 : "+d.status}),this.obj.append(htmlStr),$(".flickingWrap").height(this.obj.height()),c=$("#am12-lesson-1"),this.nextBtn=c.find(".nextAction1"),this.radioBox=c.find(".userCorrect"),this.radioBox.on("change",$.proxy(this.selectQuestion,this)),this.nextBtn.on("click",$.proxy(this.questionCompletion,this));else{for(var f=0;f<e.length;f++)e[f].parentOptionId==this.nextLayer1&&(a=$("#writing-template-card2").html(),b=Handlebars.compile(a),htmlStr=b({character:d.character,user:d.user,translate:e[f].translate,koTxt:e[f].media.koreanText,engTxt:e[f].media.englishText,optionItem:e[f].options,id:e[f].id,order:e[f].order,instruction:e[f].instruction}),this.obj.append(htmlStr),$(".flickingWrap").height(this.obj.height()),scroll.gotoNext(),c=$("#am12-lesson-2"),this.nextBtn=c.find(".nextAction1"),this.radioBox=c.find(".userCorrect"),this.radioBox.on("change",$.proxy(this.selectQuestion,this)),this.nextBtn.on("click",$.proxy(this.questionCompletion,this)));_band.drawInfo.model.resolvedIndex=this.count-1,scroll.gotoNext()}},"short":function(){var a,b,c=(this.count,this.model),d=c.questions;if(1==this.count){a=$("#writing-template-card3").html(),b=Handlebars.compile(a),htmlStr=b({character:c.character,user:c.user,translate:d[0].translate,parentId:d[0].id,id:d[0].id,placeholder:c.placeholder,engTxt:d[0].media.englishText,koTxt:d[0].media.koreanText,hint:d[0].hint,blankTxt:d[0].blankedHtml,order:d[0].order,instruction:d[0].instruction,paymentType:_band.info.model.paymentType,completeBand:_band.info.model.completeBand}),this.obj.append(htmlStr);var e=$("#am12-lesson-3");this.nextLayer1=e.children().attr("data-id"),$(".flickingWrap").height(this.postParent.height()),_band.drawInfo.model.resolvedIndex=this.count-1}else for(var f=this.nextLayer3||this.nextLayer2||this.nextLayer1,g=0;g<d.length;g++)if(d[g].parentOptionId==f){a=$("#writing-template-card3").html(),b=Handlebars.compile(a),htmlStr=b({character:c.character,user:c.user,translate:d[g].translate,parentId:d[g].parentOptionId,id:d[g].id,placeholder:c.placeholder,engTxt:d[g].media.englishText,koTxt:d[g].media.koreanText,hint:d[g].hint,blankTxt:d[g].blankedHtml,order:d[g].order,instruction:d[g].instruction,paymentType:_band.info.model.paymentType,completeBand:_band.info.model.completeBand}),this.obj.append(htmlStr),this.hitBtn=this.obj.find(".hitBtn");var e=$("#am12-lesson-3");this.hitBtn.on("click",$.proxy(this.showHint,this)),$(".flickingWrap").height(this.postParent.height()),_band.drawInfo.model.resolvedIndex=this.count-1,this.model.isComplete||scroll.gotoNext()}e.byteCheck({obj:".txtBox",tar:".txtByte",maxCnt:150}),e.find(".submitBtn").on("click",$.proxy(this.showSubmitBtn,this))},showHint:function(a){var b=$(a.currentTarget),c=b.next();b.hasClass("close")?(b.text("힌트 열기").removeClass("close").addClass("open"),c.hide()):(b.text("힌트 닫기").removeClass("open").addClass("close"),c.show()),$(".flickingWrap").height(this.postParent.height())},isMultiple:function(){this.questionCont-this.count>=1?this.multiple():this["short"]()},questionCompletion:function(a){var b=$(a.currentTarget).closest(".post-card");return"solve"!=b.data("question")?void alert("문제를 풀어 주세요!"):(disable.completionPost(a),$(a.currentTarget).hide(),this.count+=1,_band.drawInfo.model.resolvedIndex=this.count,void this.isMultiple())},selectQuestion:function(a){var b=$(a.currentTarget),c=$(a.currentTarget).closest(".writingPost").find(".bubble"),d=$(a.currentTarget).closest(".post-card");this["nextLayer"+this.count]=b.attr("data-id"),this["questionId"+this.count]=b.attr("data-qsid"),this["userAnswerIndex"+this.count]=b.parent().index()+1;var e=b.next().text(),f=b.next().attr("data-translate");userTextBoxTemplte="<p class='ko'>"+f+"</p><p class='eng'>"+e+"</p>",c.eq(1).html(userTextBoxTemplte),d.data("question","solve")},showSubmitBtn:function(a){var b=1==this.count?$("#"+this["nextLayer"+this.count]).find(".txtBox"):$("#"+this["nextLayer"+(this.count-1)]).find(".txtBox"),c=b.val(),d=$("#comfirmSubmit");return c?("FREE"!==_band.info.model.paymentType?this.waitContent.show():$("#pm12-feedback").show(),this.postParent.data("solvingEnd",!0),$(".flickingWrap").height(this.postParent.height()),d.showModal(),void d.find(".ok").on("click",{event:a},$.proxy(this.submit,this))):(alert("글을 등록하세요"),!1)},submit:function(a){if(a.preventDefault(),!this.submitFlag){if(this.submitFlag=1,this.dialogShowBtn=this.obj.find(".dialogShowBtn"),"FREE"===_band.info.model.paymentType)return $comfirmSubmit=$("#comfirmSubmit"),$trialToCharge=$("#trialToCharge"),$trialToCharge.find(".correction_go > img").attr("src","/dist/images/icon/correction_go_pop2.png"),$comfirmSubmit.hideModal(),$trialToCharge.showModal(),void $.proxy(this.feedback(),this);var b=$("#loadingImg"),c=this,d=1==this.count?$("#"+this["nextLayer"+this.count]).find(".txtBox"):$("#"+this["nextLayer"+(this.count-1)]).find(".txtBox"),e=d.val(),f=_band.info.model.lessonId,g=$(".dialogTxt");g.find(".left.ko"),g.find(".left.eng"),g.find(".right.ko"),g.find(".right.eng");disable.completionPost(a.data.event),$("#comfirmSubmit").hideModal(),$("#am12-lesson-3 .submitBtn").hide(),disable.completionPost($("#am12-lesson-3 .submitBtn")),this.dialogShowBtn.parent().show(),$(".flickingWrap").height(this.postParent.height()),this.userAnswerIndex3=e,this.questionId3=d.attr("data-id");for(var h=0;h<this.questionCont+1;h++)if(this["questionId"+(h+1)]){var i={questionId:this["questionId"+(h+1)],answer:this["userAnswerIndex"+(h+1)]};this.submitData.push(i)}if(!this.questionId1&&1==this.count){var i={questionId:this.model.questions[0].id,answer:this.userAnswerIndex3};this.submitData[0]=i}var j=this.submitData;if("FREE"===_band.info.model.paymentType){var k=$("#trialToCharge");return k.showModal(),void view.info.setCompleatePost("writingPostComplete")}b.show(),$.ajax({url:URL+"/lesson/writingPost/"+f,dataType:"json",contentType:"application/json",data:JSON.stringify(j),type:"POST",error:function(a,b){$("#failedSubmit").showModal()},success:function(a){b.hide();var d,e,f=a.result.writingDialogs,h=[],i=[],j=[],k=c.model,l=(k.questions,$("#am12-lesson-3"));$.each(f,function(a,b){"ANSWER"==b.type&&h.push(b),"QUESTION"==b.type&&i.push(b)});for(var m=0;m<h.length;m++){var n={answer:h[m],question:i[m]};j.push(n)}d=$("#writing-template-card4").html(),e=Handlebars.compile(d),htmlStr=e({order:Number(c.questionCont)+1,character:k.character,user:k.user,feedback:k.feedBack,completeBand:_band.info.model.completeBand,length:j.length-1,dialDatas:j}),a.result.curriculum||(c.obj.append(htmlStr),g.show(),c.dialogShowBtn.show()),$(".correction-wait").show(),$(".flickingWrap").height(c.postParent.height()),d=$("#feedback-policy").html(),e=Handlebars.compile(d),htmlStr=e({completeBand:_band.info.model.completeBand,correctionPolicy:a.result.writingCorrectionPolicy}),l.append(htmlStr),$(".flickingWrap").height(c.postParent.height()+100),_band.drawInfo.model.resolvedIndex=3,view.info.setCompleatePost("writingPostComplete"),view.info.setModal(a.result),scroll.gotoTop()}})}},userAnswerFun:function(){for(var a=this.model.writingAnswers,b=a.length,c=this.model,d=0;b>d;d++)if(b-2>=d&&b-2>=0){this.multiple();var e=$("#am12-lesson-"+this.count),f=e.find(".userCorrect").eq(a[d].answer-1),g=e.find(".nextAction1"),h=e.find(".me .bubble");f.prop("checked",!0),g.hide(),this["nextLayer"+this.count]=f.attr("data-id"),this["questionId"+this.count]=f.attr("data-qsid"),this["userAnswerIndex"+this.count]=f.parent().index()+1;var i=f.next().text(),j=f.next().attr("data-translate"),k="<p class='ko'>"+j+"</p><p class='eng'>"+i+"</p>";h.append(k),this.count+=1}else{this["short"]();var e=$("#am12-lesson-3"),g=e.find(".submitBtn"),l=e.find(".txtBox");l.text(a[d].answer),g.hide(),this.hitBtn=this.obj.find(".hitBtn"),this.hitBtn.on("click",$.proxy(this.showHint,this))}var m,n,o=this.model.writingDialogs,p=[],q=[],r=[],s=$("#am12-lesson-3");this.model.curriculum;$.each(o,function(a,b){"ANSWER"==b.type&&p.push(b),"QUESTION"==b.type&&q.push(b)});for(var d=0;d<p.length;d++){var t={answer:p[d],question:q[d]};r.push(t)}m=$("#writing-template-card4").html(),n=Handlebars.compile(m),htmlStr=n({order:Number(this.questionCont)+1,character:c.character,user:c.user,feedback:c.feedBack,completeBand:_band.info.model.completeBand,length:r.length-1,dialDatas:r}),this.model.isCurriculum||(this.obj.find(".correction-wait").show(),this.obj.append(htmlStr),$(".flickingWrap").height(this.postParent.height())),disable.completionPost($("#writingPost")),$(".flickingWrap").height(this.postParent.height()),m=$("#feedback-policy").html(),n=Handlebars.compile(m),htmlStr=n({completeBand:_band.info.model.completeBand,correctionPolicy:c.correctionPolicy}),s.append(htmlStr)},setBlanckedHTML:function(a){var b;return b=$("<p>"+a+"</p>").find("span").each(function(a,b){var c=$(b);"underline"===c.css("text-decoration")&&c.css({color:"#ff4800","text-decoration":"none","background-color":"#ffd800"}),c.css("background-color")&&c.css("background-color","#ffd800")}).end().prop("outerHTML")},feedback:function(){var a=_band.data.anotherUserWritingFeedback;this.another={userName:a.userName,userThumbnailUrl:a.userThumbnailUrl,show:!0,correctionHtml:a.inspectedCorrection.html,anotherInspectedPronunciations:a.inspectedPronunciations,blankedHTML:this.setBlanckedHTML(a.inspectedCorrection.html),globalError:a.inspectedCorrection.hasOwnProperty("globalError")?a.inspectedCorrection.globalError:"",localErrors:a.inspectedCorrection.hasOwnProperty("localErrors")?a.inspectedCorrection.localErrors:"",text:a.userText||"",tutor:a.tutor.name,tutorImg:a.tutor.thumbnailFileName||"/dist/images/icon/none-profile.png",feedback:a.inspectedCorrection.hasOwnProperty("globalErrorDescription")?a.inspectedCorrection.globalErrorDescription:""};var b,c=$("#writing-feedback-template").html(),d=Handlebars.compile(c),e=$("#am12-lesson-3");b=d({link:"WRITING"==_band.info.model.freeQuestionType?"lite_package.html":"premium_package.html",money:!1,showAnotherFeedback:!0,anotherUserName:this.another.userName,anotherThumbnail:this.another.userThumbnailUrl,anotherHtml:this.another.blankedHTML,anotherText:this.another.text,anotherTutor:this.another.tutor,anotherTutorImg:this.another.tutorImg,anotherFeedback:this.another.feedback}),e.append(b),e.find(".correction-wait").hide(),$(".flickingWrap").height(this.postParent.height());var f=this.obj.find(".hide-correction"),g=this;f.on("click",function(a){return a.preventDefault(),$(this).hasClass("hide-correction")?(g.obj.find(".feedback").hide(),$(".flickingWrap").height(g.postParent.height()),void $(this).removeClass("hide-correction").addClass("show-correction").text("첨삭 열기")):$(this).hasClass("show-correction")?(g.obj.find(".feedback").show(),$(".flickingWrap").height(g.postParent.height()),void $(this).removeClass("show-correction").addClass("hide-correction").text("첨삭 닫기")):void 0})}},view.writingFeedback={model:void 0,init:function(){this.model=this.model||_band.writingFeedback.model,this.$feedbackWrapper=$("#am12-lesson-3"),this.$btnCorrection=$("#writingPost").next().find(".btn-correction");var a=(!_band.info.model.freeQuestionType,this.model.anotherFeedback);"FREE"==_band.info.model.paymentType?this.mine={show:!1,feedbackGrade:"",feedbackGradeImg:"",userText:"",correctionHtml:"",blankedHTML:"",globalError:"",localErrors:[],text:"",tutor:"",tutorImg:"/dist/images/icon/none-profile.png",feedback:""}:(this.inspectedGrammarType=this.model.feedback.hasOwnProperty("inspectedGrammarType")?this.model.feedback.inspectedGrammarType:void 0,this.tutorGroup=this.model.tutorGroup,this.mine={show:!0,feedbackGrade:"",feedbackGradeImg:"",userText:this.model.feedback.userText,correctionHtml:this.model.feedback.hasOwnProperty("inspectedCorrection")?this.model.feedback.inspectedCorrection.html:"",blankedHTML:"",globalError:"",localErrors:[],text:this.model.feedback.userText||"",tutor:this.tutorGroup.tutor.name||"",tutorImg:this.tutorGroup.tutor.thumbnailFileName||"/dist/images/icon/none-profile.png",feedback:this.model.feedback.hasOwnProperty("inspectedCorrection")?this.model.feedback.inspectedCorrection.globalErrorDescription:""},this.mine.blankedHTML=this.setBlanckedHTML("mine",this.mine.correctionHtml)),this.another={userName:a?a.userName:"학습자",userThumbnailUrl:a?a.userThumbnailUrl:"/dist/images/icon/none-profile.png",show:!1,correctionHtml:a?a.inspectedCorrection.html:"",blankedHTML:"",globalError:"",localErrors:[],text:a?a.userText:"",tutor:a?a.tutor.name:"",tutorImg:a?a.tutor.thumbnailFileName:"/dist/images/icon/none-profile.png",feedback:a?a.inspectedCorrection.globalErrorDescription:""
},this.another.blankedHTML=this.setBlanckedHTML("another",this.another.correctionHtml),this.mine||(this.mine.show=!0),this.setFeedbackGrade(this.inspectedGrammarType),this.setTemplate(),$(window).on("hashchange",$.proxy(this.showHideConfirmFeedbackBtn,this))},setFeedbackGrade:function(a){switch(a){case"CANNOT_CORRECT":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="Can't Correct",this.mine.feedbackGradeImg="/dist/images/icon/correctionType2.png";break;case"PERFECT":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="Perfect!",this.mine.feedbackGradeImg="/dist/images/icon/correctionType1.png";break;case"SEMI_PERFECT":this.mine.show=!0,this.another.show=!0,this.mine.feedbackGrade="Perfect!",this.mine.feedbackGradeImg="/dist/images/icon/correctionType1.png";break;case"DOJI":this.mine.show=!0,this.another.show=!1,this.mine.feedbackGrade="",this.mine.feedbackGradeImg="",this.mine.feedback+="<br/><strong>* 다음 부터는 주어진 형식에 맞게 답안을 답해보세요! 실력향상에 더욱 도움이 될거에요 : )</strong>";break;default:this.another={},this.mine.show=!0,this.another.show=!1,this.mine.feedbackGrade="",this.mine.feedbackGradeImg=""}},setBlanckedHTML:function(a,b){var c,d=this;return c=$("<p>"+b+"</p>").find("span").each(function(b,c){var e=$(c);"underline"===e.css("text-decoration")&&(d[a].globalError=e,e.css({color:"#ff4800","text-decoration":"none","background-color":"#ffd800"})),e.css("background-color")&&(d[a].localErrors.push(e),e.css("background-color","#ffd800"))}).end().prop("outerHTML")},setTemplate:function(){var a,b=$("#writing-feedback-template").html(),c=Handlebars.compile(b),d=!_band.info.model.freeQuestionType;if(a=c(d?{money:!0,showFeedback:this.mine.show,userID:_band.info.model.userName,thumbnail:_band.info.model.userThumbnail,feedbackGradeImg:this.mine.feedbackGradeImg,feedbackGrade:this.mine.feedbackGrade,userText:this.mine.userText,html:this.mine.blankedHTML,tutor:this.mine.tutor,tutorImg:this.mine.tutorImg,feedbackWords:this.mine.feedback,showAnotherFeedback:this.another.show,anotherUserName:this.another.userName,anotherThumbnail:this.another.userThumbnailUrl,anotherHtml:this.another.blankedHTML,anotherText:this.another.text,anotherTutor:this.another.tutor,anotherTutorImg:this.another.tutorImg,anotherFeedback:this.another.feedback}:{link:"WRITING"==_band.info.model.freeQuestionType?"lite_package.html":"premium_package.html",money:!1,showAnotherFeedback:!0,anotherUserName:this.another.userName,anotherThumbnail:this.another.userThumbnailUrl,anotherHtml:this.another.blankedHTML,anotherText:this.another.text,anotherTutor:this.another.tutor,anotherTutorImg:this.another.tutorImg,anotherFeedback:this.another.feedback}),d){if(this.model.feedback.hasOwnProperty("inspectedCorrection")){this.$feedbackWrapper.append(a),this.$feedbackWrapper.find(".correction-wait").hide(),this.$feedbackWrapper.find(".hide-correction").on("click",$.proxy(this.hideShowFeedback,this));var e=this.model.feedback.hasOwnProperty("inspectedCorrection")?this.model.feedback.inspectedCorrection.text:"",f=$("#am12-lesson-4").find(".userAnswer");f.html(e)}_band.info.model.writingFeedbackCheck||(this.showHideConfirmFeedbackBtn(),this.$btnCorrection.on("click",$.proxy(this.confirmFeedback,this)),$(window).scroll($.proxy(this.confirmFeedback,this)))}},hideShowFeedback:function(a){var b=$("#writingPost"),c=$(".flickingWrap"),d=$(a.currentTarget);return d.hasClass("hide-correction")?(this.$feedbackWrapper.find(".feedback").hide(),c.height(b.height()),void d.removeClass("hide-correction").addClass("show-correction").text("첨삭 열기")):d.hasClass("show-correction")?(this.$feedbackWrapper.find(".feedback").show(),c.height(b.height()),void d.removeClass("show-correction").addClass("hide-correction").text("첨삭 닫기")):void 0},showHideConfirmFeedbackBtn:function(){2==_band.drawInfo.model.postIndex?this.$btnCorrection.parent().show():this.$btnCorrection.parent().hide()},confirmFeedback:function(a){function b(){$(window).off("scroll",view.writingFeedback.confirmFeedback),_band.info.model.writingFeedbackCheck=!0,$("#writingPost").next().find(".btn-correction").remove(),$(".timeBtn li").eq(2).find(".hasFeedback").hide(),$(".visual-top .btn").removeClass("drawer-new").addClass("drawer")}if(2==_band.drawInfo.model.postIndex)if("scroll"==a.type){var c=$("#pm12-feedback").offset().top-$(window).height(),d=$(a.target).scrollTop();d>1.5*c&&$.ajax({url:URL+"/lesson/writingFeedback/"+_band.info.model.lessonId,type:"POST",success:function(a){console.log("스크롤로 writing 피드백 확인 전송!"),b()}})}else $.ajax({url:URL+"/lesson/writingFeedback/"+_band.info.model.lessonId,type:"POST",success:function(a){console.log("첨삭 확인 버튼으로 writing 피드백 확인 전송!"),b(),scroll.gotoTarget("#pm12-feedback")}})}},view.speaking={model:void 0,init:function(){this.model=this.model||_band.speaking.model,this.paymentType=_band.info.model.paymentType,this.totalCount=this.model.questions.length-1,this.questionCont=this.model.questions[this.totalCount].order,this.obj=$("#speakingPost"),this.postParent=this.obj.parents("section"),this.waitContent=this.obj.find(".correction-wait"),this.questionData1=[],this.questionData2=[],this.korQuestion=[],this.engQuestion=[],this.korAnswer=[],this.engAnswer=[],this.userAnswer=null,this.count=1,this.nextLayer1=null,this.nextLayer2=null,this.nextLayer3=null,this.questionId1=null,this.questionId2=null,this.questionId3=null,this.userAnswerIndex1=null,this.userAnswerIndex2=null,this.userAnswerIndex3=null,this.submitFlag=0,this.submitData=[],this.newCurriculum=this.model.newCurriculum,this.model.isComplete?$.proxy(this.userAnswerFun(),this):$.proxy(this.isMultiple(),this)},multiple:function(){var a,b,c,d=(this.count,this.model),e=d.questions;if(1!=this.count||this.newCurriculum)if(1==this.count||this.newCurriculum)this.newCurriculum&&(a=$("#speaking-template-card-new1").html(),b=Handlebars.compile(a),htmlStr=b({character:d.character,user:d.user,translate:e[0].translate,koTxt:null==e[0].media.koreanText?null:e[0].media.koreanText,engTxt:null==e[0].media.englishText?null:e[0].media.englishText,optionItem:e[0].options,nuances:e[0].options.nuance,id:e[0].id,order:e[0].order,normalSpeaking:e[0].normalSpeakingFileName,slowSpeaking:e[0].slowSpeakingFileName,instruction:e[0].instruction}),this.obj.append(htmlStr),this.hitBtn=this.obj.find(".hitBtn"),this.hitBtn.on("click",$.proxy(this.showHint,this)),$(".flickingWrap").height(this.obj.height()),c=$("#am14-lesson-1-new"),this.nextBtn=c.find(".nextAction1"),this.radioBox=c.find(".userCorrect"),this.radioBox.on("change",$.proxy(this.selectNewCurriculumQuestion,this)),this.nextBtn.on("click",$.proxy(this.questionCompletion,this)));else{for(var f=0;f<e.length;f++)e[f].parentOptionId==this.nextLayer1&&(a=$("#speaking-template-card2").html(),b=Handlebars.compile(a),htmlStr=b({character:d.character,user:d.user,translate:e[f].translate,koTxt:null==e[f].media.koreanText?null:e[f].media.koreanText,engTxt:null==e[f].media.englishText?null:e[f].media.englishText,optionItem:e[f].options,id:e[f].id,order:e[f].order,normalSpeaking:e[f].normalSpeakingFileName,slowSpeaking:e[f].slowSpeakingFileName,instruction:e[f].instruction}),this.obj.append(htmlStr),this.hitBtn=this.obj.find(".hitBtn"),this.hitBtn.on("click",$.proxy(this.showHint,this)),$(".flickingWrap").height(this.obj.height()),scroll.gotoNext(),c=$("#am14-lesson-2"),this.nextBtn=c.find(".nextAction1"),this.radioBox=c.find(".userCorrect"),this.radioBox.on("change",$.proxy(this.selectQuestion,this)),this.nextBtn.on("click",$.proxy(this.questionCompletion,this)));_band.drawInfo.model.resolvedIndex=this.count-1,scroll.gotoNext()}else a=$("#speaking-template-card1").html(),b=Handlebars.compile(a),htmlStr=b({character:d.character,user:d.user,translate:e[0].translate,koTxt:e[0].media.koreanText,engTxt:e[0].media.englishText,optionItem:e[0].options,id:e[0].id,order:e[0].order,normalSpeaking:e[0].normalSpeakingFileName,slowSpeaking:e[0].slowSpeakingFileName,instruction:e[0].instruction}),this.obj.append(htmlStr),this.hitBtn=this.obj.find(".audioTextBtn .hitBtn"),this.hitBtn.on("click",$.proxy(this.showHint,this)),$(".flickingWrap").height(this.obj.height()),c=$("#am14-lesson-1"),this.nextBtn=c.find(".nextAction1"),this.radioBox=c.find(".userCorrect"),this.radioBox.on("change",$.proxy(this.selectQuestion,this)),this.nextBtn.on("click",$.proxy(this.questionCompletion,this))},"short":function(){var a,b,c=(this.count,this.model),d=c.questions;if(1!=this.count||this.newCurriculum){if(1==this.count||this.newCurriculum){if(this.newCurriculum)for(var e=this.nextLayer3||this.nextLayer2||this.nextLayer1,f=0;f<d.length;f++)if(d[f].parentOptionId==e){a=$("#speaking-template-card-new2").html(),b=Handlebars.compile(a),htmlStr=b({character:c.character,user:c.user,translate:d[f].translate,parentId:d[f].parentOptionId,id:d[f].id,placeholder:c.placeholder,koTxt:null==d[f].media?null:d[f].media.koreanText,engTxt:null==d[f].media?null:d[f].media.englishText,koGuide:d[f].koreanText,nuances:d[f].nuance,hint:d[f].hint,blankTxt:d[f].blankedHtml,order:d[f].order,instruction:d[f].instruction,normalSpeaking:d[f].normalSpeakingFileName,slowSpeaking:d[f].slowSpeakingFileName,paymentType:this.paymentType,completeBand:_band.info.model.completeBand,record:!1}),this.obj.append(htmlStr);var g=$("#am14-lesson-3-new"),h=g.find(".bubble"),i=$("#am14-lesson-1-new").find("input[type=radio][name=am14-lesson1-select-en]:checked"),j=$(i).siblings("label").attr("data-color").toLowerCase();h.addClass(j),this.hitBtn=this.obj.find(".hint .hitBtn"),this.hitBtn.on("click",$.proxy(this.showHint,this)),$(".flickingWrap").height(this.postParent.height()),_band.drawInfo.model.resolvedIndex=this.count-1,this.model.isComplete||scroll.gotoNext()}}else for(var e=this.nextLayer3||this.nextLayer2||this.nextLayer1,f=0;f<d.length;f++)if(d[f].parentOptionId==e){a=$("#speaking-template-card3").html(),b=Handlebars.compile(a),htmlStr=b({character:c.character,user:c.user,translate:d[f].translate,parentId:d[f].parentOptionId,id:d[f].id,placeholder:c.placeholder,koTxt:null==d[f].media?null:d[f].media.koreanText,engTxt:null==d[f].media?null:d[f].media.englishText,koGuide:d[f].koreanText,nuances:d[f].options.nuance,hint:d[f].hint,blankTxt:d[f].blankedHtml,order:d[f].order,instruction:d[f].instruction,normalSpeaking:d[f].normalSpeakingFileName,slowSpeaking:d[f].slowSpeakingFileName,paymentType:this.paymentType,completeBand:_band.info.model.completeBand,record:!1}),this.obj.append(htmlStr);var g=$("#am14-lesson-3");this.hitBtn=this.obj.find(".hitBtn"),this.hitBtn.on("click",$.proxy(this.showHint,this)),$(".flickingWrap").height(this.postParent.height()),_band.drawInfo.model.resolvedIndex=this.count-1,this.model.isComplete||scroll.gotoNext()}}else{a=$("#speaking-template-card3").html(),b=Handlebars.compile(a),htmlStr=b({character:c.character,user:c.user,translate:d[0].translate,parentId:d[0].id,id:d[0].id,placeholder:c.placeholder,koTxt:null==d[0].media.koreanText?null:d[0].media.koreanText,engTxt:null==d[0].media.englishText?null:d[0].media.englishText,hint:d[0].hint,blankTxt:d[0].blankedHtml,order:d[0].order,nuances:d[0].options.nuance,instruction:d[0].instruction,paymentType:this.paymentType,completeBand:_band.info.model.completeBand,normalSpeaking:d[0].normalSpeakingFileName,slowSpeaking:d[0].slowSpeakingFileName,record:!1}),this.obj.append(htmlStr);var g=$("#am14-lesson-3");this.nextLayer1=g.children().attr("data-id"),this.hitBtn=this.obj.find(".audioTextBtn .hitBtn"),this.hitBtn.on("click",$.proxy(this.showHint,this)),$(".flickingWrap").height(this.postParent.height()),_band.drawInfo.model.resolvedIndex=this.count-1}g.byteCheck({obj:"#speaking-memo",tar:".txtByte",byteCheckOnly:!0,maxCnt:150}),g.find(".record").on("click",$.proxy(this.recording,this))},showHint:function(a){a.preventDefault();var b=$(a.currentTarget),c=b.parent().next();b.parent().hasClass("hint")?solution.showBox(a):b.parent().hasClass("audioTextBtn")&&(b.hasClass("close")?(b.text("스크립트 열기").removeClass("close").addClass("open"),c.hide()):(b.text("스크립트 닫기").removeClass("open").addClass("close"),c.show()),$(".flickingWrap").height(this.postParent.height()))},isMultiple:function(){this.questionCont-this.count>=1?this.multiple():this["short"]()},questionCompletion:function(a){var b=$(a.currentTarget).closest(".post-card");return"solve"!=b.data("question")?void alert("문제를 풀어 주세요!"):(disable.completionPost(a),$(a.currentTarget).hide(),this.count+=1,_band.drawInfo.model.resolvedIndex=this.count,void this.isMultiple())},selectNewCurriculumQuestion:function(a){var b=$(a.currentTarget),c=$(a.currentTarget).closest(".speakingPost").find(".bubble"),d=$(a.currentTarget).closest(".post-card"),e=b.parent(),f=b.next(),g=e.siblings(),h=g.children("label"),i=h.children("img.show"),j=h.children("img.hide"),k=f.children("img.show"),l=f.children("img.hide"),m=b.next().find(".engNuance").attr("data-kor"),n=b.next().attr("data-translate"),o=h.attr("data-color").toLowerCase(),p=b.next().attr("data-color").toLowerCase(),q="<p>( "+m+" )<br>"+n+"</p>";this["nextLayer"+this.count]=b.attr("data-id"),this["questionId"+this.count]=b.attr("data-qsid"),this["userAnswerIndex"+this.count]=b.parent().index()+1,i.attr("src").indexOf("_d")>-1?(k.removeClass("show").addClass("hide"),l.removeClass("hide").addClass("show")):(i.removeClass("show").addClass("hide"),j.removeClass("hide").addClass("show"),k.removeClass("show").addClass("hide"),l.removeClass("hide").addClass("show")),c.hasClass(o)&&c.removeClass(o),c.addClass(p),h.hasClass(o)&&h.removeClass(o),f.addClass(p),c.eq(1).html(q),$(".flickingWrap").height(this.postParent.innerHeight()),d.data("question","solve")},selectQuestion:function(a){var b=$(a.currentTarget),c=$(a.currentTarget).closest(".speakingPost").find(".bubble"),d=$(a.currentTarget).closest(".post-card"),e=b.next().text(),f=b.next().attr("data-translate"),g="<p class='ko'>"+f+"</p><p class='eng'>"+e+"</p>";this["nextLayer"+this.count]=b.attr("data-id"),this["questionId"+this.count]=b.attr("data-qsid"),this["userAnswerIndex"+this.count]=b.parent().index()+1,c.eq(1).html(g),d.data("question","solve")},recording:function(a){var b,c=_band.info.model.lessonId,d=$(a.target).parents(".speakingRecord").attr("data-id"),e=_band.info.model.scheduledPostSetId,f=encodeURIComponent(URL+"/lesson/speakingView/"+c+"/"+e+"/"+d),g=this.model.duration;if(!band.Partners.isSupported("runRecorder")){if(/Android/i.test(isMobile.any())&&!band.Partners.isSupported("purchasePartnerProduct"))return alert("BAND 최신 버전으로 업데이트 해주세요."),!1;if(/iPhone|iPad|iPod/i.test(isMobile.any())&&!band.Partners.isSupported("purchasePartnerProduct"))return alert("iOS버전은 준비 중입니다. \n최대한 빠르게 업데이트 할 예정이니 조금만 기다려주세요."),!1}if("FREE"!=this.paymentType)b={text:$("#speaking-memo").val()||""},$.ajax({url:URL+"/lesson/speakingPost/text/"+c,dataType:"json",contentType:"application/json",data:JSON.stringify(b),type:"POST",error:function(a,b){$("#failedSubmit").showModal()},success:function(a){if(/Android/i.test(isMobile.any()))window.location.href="bandapp://open/record?view_url="+f+"&callback=receive_record_data&limit="+g;else{if(!/iPhone|iPad|iPod/i.test(isMobile.any()))return;window.location.href="bandinapp://record/band?view_url="+f+"&callback=receive_record_data&limit="+g}}});else if(/Android/i.test(isMobile.any()))window.location.href="bandapp://open/record?view_url="+f+"&callback=receive_record_data&limit="+g;else{if(!/iPhone|iPad|iPod/i.test(isMobile.any()))return;window.location.href="bandinapp://record/band?view_url="+f+"&callback=receive_record_data&limit="+g}},submit:function(a,b){this.dialogShowBtn=this.obj.find(".dialogShowBtn");var c="";if(c=this.model.isCurriculum?$("#am14-lesson-3-new").find(">div"):$("#am14-lesson-3").find(">div"),"FREE"===this.paymentType)return $comfirmSubmit=$("#comfirmSubmit"),$trialToCharge=$("#trialToCharge"),$trialToCharge.find(".trial-time").text("14"),$comfirmSubmit.hideModal(),$trialToCharge.showModal(),view.info.setCompleatePost("speakingPostComplete"),void $.proxy(this.feedback(),this);var d=$("#loadingImg"),e=this,f=_band.info.model.lessonId,g=$(".dialogTxt");g.find(".left.ko"),g.find(".left.eng"),g.find(".right.ko"),g.find(".right.eng");$("#comfirmSubmit").hideModal(),$("#am14-lesson-3 .submitBtn").hide(),disable.completionPost($("#am14-lesson-3 .submitBtn")),this.dialogShowBtn.parent().show(),$(".flickingWrap").height(this.postParent.height()),this.questionId2||2!=this.count?this.questionId3||3!=this.count||(this.userAnswerIndex3=a,this.questionId3=c.attr("data-id")):(this.userAnswerIndex2=a,this.questionId2=c.attr("data-id"));for(var h=0;h<this.questionCont+1;h++)if(this["questionId"+(h+1)]){var i={questionId:this["questionId"+(h+1)],answer:this["userAnswerIndex"+(h+1)]};this.submitData.push(i)}if(!this.questionId1&&1==this.count){var i={questionId:this.model.questions[0].id,answer:a};this.submitData[0]=i}var j=this.submitData;d.show(),$.ajax({url:URL+"/lesson/speakingPost/"+f+"?duration="+b,dataType:"json",contentType:"application/json",data:JSON.stringify(j),type:"POST",error:function(a,b){$("#failedSubmit").showModal()},success:function(a){d.hide();var b,c,f,h=a.result.speakingDialogs,i=[],j=[],k=[],l=e.model,m=(l.questions,a.result.curriculum?$("#am14-lesson-3-new"):$("#am14-lesson-3")),n=$(".record");$.each(h,function(a,c){"ANSWER"==c.type&&i.push(c),"QUESTION"==c.type&&j.push(c),c.userVoice&&(b=c.userVoice)});for(var o=0;o<j.length;o++){var p={answer:i[o],question:j[o]};k.push(p)}c=$("#speaking-template-card4").html(),f=Handlebars.compile(c),htmlStr=f({order:Number(e.questionCont)+1,character:l.character,user:l.user,feedback:l.feedBack,completeBand:_band.info.model.completeBand,length:k.length-1,dialDatas:k}),a.result.curriculum||(e.obj.append(htmlStr),g.show(),e.dialogShowBtn.show()),$(".correction-wait").show(),$(".flickingWrap").height(e.postParent.height()),n.css({"background-color":"#d3d8de",border:"none",color:"#000"}),n.find(">span").text("녹음완료").css({background:"none",padding:0}),n.off("click",$.proxy(this.recording,this)),c=$("#feedback-policy").html(),f=Handlebars.compile(c),htmlStr=f({completeBand:_band.info.model.completeBand,correctionPolicy:a.result.speakingCorrectionPolicy}),m.append(htmlStr),$(".flickingWrap").height(e.postParent.height()),_band.drawInfo.model.resolvedIndex=3,view.info.setCompleatePost("speakingPostComplete"),view.info.setModal(a.result),disable.completionPost($("#speakingPost")),scroll.gotoTop()}})},userAnswerFun:function(){for(var a=this.model.speakingAnswers,b=this.model.speakingAnswerText,c=a.length,d=this.model,e=0;c>e;e++)if(c-2>=e&&c-2>=0&&!this.newCurriculum){this.multiple();var f=$("#am14-lesson-"+this.count),g=f.find(".userCorrect").eq(a[e].answer-1),h=f.find(".me .bubble"),i=$("#speaking-memo"),j=f.find(".nextAction1");g.prop("checked",!0),i.text(b),j.hide(),this["nextLayer"+this.count]=g.attr("data-id"),this["questionId"+this.count]=g.attr("data-qsid"),this["userAnswerIndex"+this.count]=g.parent().index()+1;var k=g.next().text(),l=g.next().attr("data-translate"),m="<p class='ko'>"+l+"</p> <p class='eng'>"+k+"</p>";h.append(m),this.count+=1}else if(c-2>=e&&c-2>=0||this.newCurriculum){if(c-2>=e&&c-2>=0&&this.newCurriculum){this.multiple();var n,o,p,q,f=$("#am14-lesson-"+this.count+"-new"),g=f.find(".userCorrect").eq(a[e].answer-1),h=f.find(".me .bubble"),i=$("#speaking-memo"),j=f.find(".nextAction1");g.prop("checked",!0),i.text(b),j.hide(),o=g.siblings("label"),n=o.attr("data-color").toLowerCase(),p=o.children("img.show"),q=o.children("img.hide"),this["nextLayer"+this.count]=g.attr("data-id"),this["questionId"+this.count]=g.attr("data-qsid"),this["userAnswerIndex"+this.count]=g.parent().index()+1;var k=g.next().find(".engNuance").attr("data-kor"),l=g.next().attr("data-translate"),m="<p>("+k+")<br>"+l+"</p>";h.append(m),h.addClass(n),o.addClass(n),p.removeClass("show").addClass("hide"),q.removeClass("hide").addClass("show"),this.count+=1}else if(!(c-2>=e&&c-2>=0)&&this.newCurriculum){this["short"]();var f=$("#am14-lesson-3-new"),j=f.find(".submitBtn"),i=$("#speaking-memo"),r=f.find(".txtBox");r.text(a[e].answer),b?i.text(b):i.hide(function(){$(this).next(".txtByte").hide()}),j.hide()}}else{this["short"]();var f=$("#am14-lesson-3"),j=f.find(".submitBtn"),i=$("#speaking-memo"),r=f.find(".txtBox");r.text(a[e].answer),b?i.text(b):i.hide(),j.hide()}var s,t,u=this.model.speakingDialogs,v=[],w=[],x=[],y=this.model.isCurriculum?$("#am14-lesson-3-new"):$("#am14-lesson-3");$.each(u,function(a,b){"ANSWER"==b.type&&v.push(b),"QUESTION"==b.type&&w.push(b)});for(var e=0;e<v.length;e++){var z={answer:v[e],question:w[e]};x.push(z)}s=$("#speaking-template-card4").html(),t=Handlebars.compile(s),htmlStr=t({order:Number(this.questionCont)+1,character:d.character,user:d.user,feedback:d.feedBack,completeBand:_band.info.model.completeBand,length:x.length-1,dialDatas:x}),this.model.isCurriculum||(this.obj.find(".correction-wait").show(),this.obj.append(htmlStr),$(".flickingWrap").height(this.postParent.height())),disable.completionPost($("#speakingPost")),this.obj.on("click",".hint .hitBtn",$.proxy(this.showHint,this)),$(".flickingWrap").height(this.postParent.height()),s=$("#feedback-policy").html(),t=Handlebars.compile(s),htmlStr=t({completeBand:_band.info.model.completeBand,correctionPolicy:d.correctionPolicy}),y.append(htmlStr);var A=$(".record");A.css({"background-color":"#d3d8de",border:"none",color:"#000"}),A.find(">span").text("녹음완료").css({background:"none",padding:0}),A.off("click",$.proxy(this.recording,this))},showSubmitBtn:function(a){var b=$("#comfirmSubmit");"FREE"!==this.paymentType?this.waitContent.show():$("#pm12-feedback").show(),this.postParent.data("solvingEnd",!0),$(".flickingWrap").height(this.postParent.height()),b.showModal(),b.find(".ok").on("click",{event:a},$.proxy(this.submit,this))},setBlanckedHTML:function(a){var b;return b=$("<p>"+a+"</p>").find("span").each(function(a,b){var c=$(b);"underline"===c.css("text-decoration")&&c.css({color:"#ff4800","text-decoration":"none","background-color":"#ffd800"}),c.css("background-color")&&c.css("background-color","#ffd800")}).end().prop("outerHTML")},feedback:function(){var a=_band.data.anotherUserSpeakingFeedback;this.another={userName:a.userName,userThumbnailUrl:a.userThumbnailUrl,show:!0,correctionHtml:a.inspectedCorrection.html,anotherInspectedPronunciations:a.inspectedPronunciations,blankedHTML:this.setBlanckedHTML(a.inspectedCorrection.html),globalError:a.inspectedCorrection.hasOwnProperty("globalError")?a.inspectedCorrection.globalError:"",localErrors:a.inspectedCorrection.hasOwnProperty("localErrors")?a.inspectedCorrection.localErrors:"",text:a.userText||"",tutor:a.tutor.name,tutorImg:a.tutor.thumbnailFileName||"/dist/images/icon/none-profile.png",feedback:a.inspectedCorrection.hasOwnProperty("globalErrorDescription")?a.inspectedCorrection.globalErrorDescription:""};var b,c=$("#speaking-feedback-template").html(),d=Handlebars.compile(c),e=$("#am14-lesson-3");b=d({link:"SPEAKING"==_band.info.model.freeQuestionType?"lite_package.html":"premium_package.html",money:!1,showAnotherFeedback:!0,anotherUserName:this.another.userName,anotherThumbnail:this.another.userThumbnailUrl,anotherHtml:this.another.blankedHTML,anotherText:this.another.text,anotherTutor:this.another.tutor,anotherTutorImg:this.another.tutorImg,anotherFeedback:this.another.feedback}),e.append(b),e.find(".correction-wait").hide(),audio.init(),$(".flickingWrap").height(this.postParent.height());var f=this.obj.find(".hide-correction"),g=this;f.on("click",function(a){return a.preventDefault(),$(this).hasClass("hide-correction")?(g.obj.find(".feedback").hide(),$(".flickingWrap").height(g.postParent.height()),void $(this).removeClass("hide-correction").addClass("show-correction").text("첨삭 열기")):$(this).hasClass("show-correction")?(g.obj.find(".feedback").show(),$(".flickingWrap").height(g.postParent.height()),void $(this).removeClass("show-correction").addClass("hide-correction").text("첨삭 닫기")):void 0})}},view.speakingFeedback={model:void 0,init:function(){this.model=this.model||_band.speakingFeedback.model,this.$feedbackWrapper=$("#am14-lesson-3"),this.$feedbackWrapperNew=$("#am14-lesson-3-new"),this.$btnCorrection=$("#speakingPost").next().find(".btn-correction"),this.postParent=this.$feedbackWrapper.parents("section")||this.$feedbackWrapperNew.parents("section");var a,b=(!_band.info.model.freeQuestionType,this.model.anotherFeedback);if("FREE"==_band.info.model.paymentType)this.mine={show:!1,feedbackGrade:"",feedbackGradeImg:"",userText:"",correctionHtml:"",inspectedPronunciations:[],blankedHTML:"",globalError:"",localErrors:[],text:"",tutor:"",tutorImg:"/dist/images/icon/none-profile.png",feedback:""};else{var c=this.model.feedback.hasOwnProperty("inspectedPronunciations")?this.model.feedback.inspectedPronunciations:void 0;if(this.inspectedGrammarType=this.model.feedback.hasOwnProperty("inspectedGrammarType")?this.model.feedback.inspectedGrammarType:void 0,this.tutorGroup=this.model.tutorGroup,c)for(a=0;a<c.length;a++)c[a].sourceSrc="/speaking/"+c[a].right;this.mine={show:!0,feedbackGrade:"",feedbackGradeImg:"",userText:this.model.feedback.userText||"",correctionHtml:this.model.feedback.hasOwnProperty("inspectedCorrection")?this.model.feedback.inspectedCorrection.html:"",inspectedPronunciations:c,blankedHTML:"",globalError:"",localErrors:[],text:this.model.feedback.userText||"",tutor:this.tutorGroup.tutor.name||"",tutorImg:this.tutorGroup.tutor.thumbnailFileName||"/dist/images/icon/none-profile.png",feedback:this.model.feedback.hasOwnProperty("inspectedCorrection")?this.model.feedback.inspectedCorrection.globalErrorDescription:""},this.mine.blankedHTML=this.setBlanckedHTML("mine",this.mine.correctionHtml)}var d=b&&b.hasOwnProperty("inspectedPronunciations")?this.model.anotherFeedback.inspectedPronunciations:void 0;if(d)for(a=0;a<d.length;a++)d[a].sourceSrc="/speaking/"+d[a].right;this.another={userName:b?b.userName:"학습자",userThumbnailUrl:b?b.userThumbnailUrl:"/dist/images/icon/none-profile.png",show:!1,correctionHtml:b?b.inspectedCorrection.html:"",anotherInspectedPronunciations:d,blankedHTML:"",globalError:"",localErrors:[],text:b?b.userText:"",tutor:b?b.tutor.name:"",tutorImg:b?b.tutor.thumbnailFileName:"/dist/images/icon/none-profile.png",feedback:b?b.inspectedCorrection.globalErrorDescription:""},this.another.blankedHTML=this.setBlanckedHTML("another",this.another.correctionHtml),this.setFeedbackGrade(this.inspectedGrammarType),this.setTemplate(),$(window).on("hashchange",$.proxy(this.showHideConfirmFeedbackBtn,this))},setFeedbackGrade:function(a){switch(a){case"CANNOT_CORRECT":this.another.show=!1,this.mine.feedbackGrade="Can't Correct",this.mine.feedbackGradeImg="/dist/images/icon/correctionType2.png";break;case"AUDIO_NOT_WORKING":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="Can't Correct",this.mine.feedbackGradeImg="/dist/images/icon/correctionType2.png";break;case"INAUDIBLE":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="Can't Correct",this.mine.feedbackGradeImg="/dist/images/icon/correctionType2.png";break;case"NO_CONTENT":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="Can't Correct",this.mine.feedbackGradeImg="/dist/images/icon/correctionType2.png";break;case"PERFECT":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="Perfect!",this.mine.feedbackGradeImg="/dist/images/icon/correctionType1.png";break;case"SPEAKING_PERFECT":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="Perfect!",this.mine.feedbackGradeImg="/dist/images/icon/correctionType1.png";break;case"GRAMMAR_PERFECT":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="",this.mine.feedbackGradeImg="";break;case"PRONUNCIATION_PERFECT":this.mine.show=!0,this.another.show=!1,this.mine.feedbackGrade="",this.mine.feedbackGradeImg="";break;case"SEMI_PERFECT":this.mine.show=!1,this.another.show=!0,this.mine.feedbackGrade="Perfect!",this.mine.feedbackGradeImg="/dist/images/icon/correctionType1.png";break;case"DOJI":this.mine.show=!0,this.another.show=!1,this.mine.feedbackGrade="",this.mine.feedbackGradeImg="",this.mine.feedback+="<br/><strong>* 다음부터는 주어진 형식에 맞게 답안을 답해보세요! 실력향상에 더욱 도움이 될거에요 : )</strong>";break;default:this.another={},this.mine.show=!0,this.another.show=!1,this.mine.feedbackGrade="",this.mine.feedbackGradeImg=""}},setBlanckedHTML:function(a,b){var c,d=this;return c=$("<p>"+b+"</p>").find("span").each(function(b,c){var e=$(c);"underline"===e.css("text-decoration")&&(d[a].globalError=e,e.css({color:"#ff4800","text-decoration":"none","background-color":"#ffd800"})),e.css("background-color")&&(d[a].localErrors.push(e),e.css("background-color","#ffd800"))}).end().prop("outerHTML")},setTemplate:function(){function a(){return"PERFECT"==h.stamp?"Perfect!":"CANNOT_CORRECT"==h.stamp?"Can't Correct":void 0}function b(){return"PERFECT"==h.stamp?"/dist/images/icon/correctionType1.png":"CANNOT_CORRECT"==h.stamp?"/dist/images/icon/correctionType2.png":void 0}var c,d,e,f=!_band.info.model.freeQuestionType,g=_band.speaking.model.newCurriculum;if(f&&!g)c=$("#speaking-feedback-template").html(),d=Handlebars.compile(c),e=d({money:!0,showFeedback:this.mine.show,userID:_band.info.model.userName,thumbnail:_band.info.model.userThumbnail,feedbackGradeImg:this.mine.feedbackGradeImg,feedbackGrade:this.mine.feedbackGrade,userText:this.mine.userText,html:this.mine.blankedHTML,tutor:this.mine.tutor,tutorImg:this.mine.tutorImg,feedbackWords:this.mine.feedback,inspectedPronunciations:this.mine.inspectedPronunciations,showAnotherFeedback:this.another.show,anotherUserName:this.another.userName,anotherThumbnail:this.another.userThumbnailUrl,anotherHtml:this.another.blankedHTML,anotherText:this.another.text,anotherTutor:this.another.tutor,anotherTutorImg:this.another.tutorImg,anotherFeedback:this.another.feedback,anotherInspectedPronunciations:this.another.anotherInspectedPronunciations}),this.model.feedback.hasOwnProperty("inspectedCorrection")&&(this.$feedbackWrapper.append(e),this.$feedbackWrapper.find(".correction-wait").hide()),_band.info.model.speakingFeedbackCheck||(this.showHideConfirmFeedbackBtn(),this.$btnCorrection.on("click",$.proxy(this.confirmFeedback,this)),$(window).scroll($.proxy(this.confirmFeedback,this)));else if(f&&g){var h=_band.answerSheetFeedback.model;c=$("#new-speaking-feedback-template").html(),d=Handlebars.compile(c);var i=new Array;$.each(h.pronunciations,function(a,b){b.sourceSrc="/speaking/"+b.right,i.push(b)}),e=d({money:!0,userID:h.userName,thumbnail:h.userThumbnail||"/dist/images/icon/none-profile.png",userAnswer:h.userAnswer,inspectorThumbnail:h.inspectorThumbnail,inspectorName:h.inspectorName,description:h.description,pronunciations:i,stamp:h.stamp,feedbackGrade:a(h.stamp),feedbackGradeImg:b(h.stamp),userAnswerFeedback:h.userAnswerFeedback,tutorName:h.userAnswerFeedback.tutorName,tutorThumbnail:h.userAnswerFeedback.tutorThumbnail,nuance:h.userAnswerFeedback.nuance,koTxt:h.userAnswerFeedback.koreanText,engTxt:h.userAnswerFeedback.englishText,speakingFile:h.userAnswerFeedback.speakingFileName,addAnswerFeedback:h.addAnswerFeedback,addTutorName:h.addAnswerFeedback.tutorName,addNuance:h.addAnswerFeedback.nuance,addKorTxt:h.addAnswerFeedback.koreanText,addEngTxt:h.addAnswerFeedback.englishText,addSpeakingFile:h.addAnswerFeedback.speakingFileName}),h.hasOwnProperty("userAnswerFeedback")&&(this.$feedbackWrapperNew.append(e),this.$feedbackWrapperNew.find(".correction-wait").hide())}else c=$("#speaking-feedback-template").html(),d=Handlebars.compile(c),e=d({link:"SPEAKING"==_band.info.model.freeQuestionType?"lite_package.html":"premium_package.html",money:!1,showAnotherFeedback:!0,anotherUserName:this.another.userName,anotherThumbnail:this.another.userThumbnailUrl,anotherHtml:this.another.blankedHTML,anotherText:this.another.text,anotherTutor:this.another.tutor,anotherTutorImg:this.another.tutorImg,anotherFeedback:this.another.feedback});this.obj=$("#pm16-feedback"),this.speaking=$("#speakingPost"),this.hideShowFeedbackBtn=this.obj.find(".hide-correction"),this.speakingBtn=this.obj.find(".btn-speak"),this.scriptBtn=this.obj.find(".scriptTextBtn a"),
this.bonusBtn=this.obj.find(".btn-bonus a"),this.hideShowFeedbackBtn.on("click",$.proxy(this.hideShowFeedback,this)),this.speakingBtn.on("click",$.proxy(this.audioPlay,this)),this.scriptBtn.on("click",$.proxy(this.showHideScriptBtn,this)),this.bonusBtn.on("click",$.proxy(this.showHideBonusArea,this))},hideShowFeedback:function(a){a.preventDefault();var b=this.obj.find(".hide-correction");return b.hasClass("hide-correction")?(this.obj.find(".feedback").hide(),$(".flickingWrap").height(this.speaking.innerHeight()),void this.hideShowFeedbackBtn.removeClass("hide-correction").addClass("show-correction").text("첨삭 열기")):b.hasClass("show-correction")?void 0:(this.obj.find(".feedback").show(),$(".flickingWrap").height(this.speaking.innerHeight()),void this.hideShowFeedbackBtn.removeClass("show-correction").addClass("hide-correction").text("첨삭 닫기"))},audioPlay:function(a){var b=$(a.currentTarget).prev()[0];b.volume=1,b.play()},showHideConfirmFeedbackBtn:function(){3==_band.drawInfo.model.postIndex?this.$btnCorrection.parent().show():this.$btnCorrection.parent().hide()},showHideScriptBtn:function(a){a.preventDefault();var b=$(a.currentTarget),c=b.parent().next();b.hasClass("close")?(b.text("스크립트 열기").removeClass("close").addClass("open"),c.hide()):(b.text("스크립트 닫기").removeClass("open").addClass("close"),c.show()),$(".flickingWrap").height(this.speaking.innerHeight())},showHideBonusArea:function(a){a.preventDefault();var b=$(a.currentTarget),c=b.parent().next();b.hasClass("close")?(b.text("보너스 열기").removeClass("close").addClass("open"),c.hide()):(b.text("보너스 닫기").removeClass("open").addClass("close"),c.show()),$(".flickingWrap").height(this.speaking.innerHeight())},confirmFeedback:function(a){function b(){$(window).off("scroll",view.speakingFeedback.confirmFeedback),_band.info.model.speakingFeedbackCheck=!0,$("#speakingPost").next().find(".btn-correction").remove(),$(".timeBtn li").eq(3).find(".hasFeedback").hide(),$(".visual-top .btn").removeClass("drawer-new").addClass("drawer")}if(3==_band.drawInfo.model.postIndex)if("scroll"==a.type){var c=$("#pm14-feedback").offset().top-$(window).height(),d=$(a.target).scrollTop();d>1.5*c&&$.ajax({url:URL+"/lesson/speakingFeedback/"+_band.info.model.lessonId,type:"POST",success:function(a){console.log("스크롤로 speaking 피드백 확인 전송!"),b()}})}else $.ajax({url:URL+"/lesson/speakingFeedback/"+_band.info.model.lessonId,type:"POST",success:function(a){console.log("첨삭 확인 버튼으로 speaking 피드백 확인 전송!"),b(),scroll.gotoTarget("#pm14-feedback")}})}},view.review={model:void 0,init:function(){this.model=this.model||_band.review.model,this.personalQs=this.model.personalQs;var a,b,c,d,e=this.model.questions,f="",g="",h="",i=[],h=[],j=[],k=$("#reviewPost");for(a=0;a<e.length;a++)b=$("#qtShort").html(),c=Handlebars.compile(b),d=c({id:e[a].id,type:e[a].type,order:"0"+e[a].order,title:"머릿속에 새기기",answerResult:e[a].answer.result,answerDes:e[a].answer.description,txt1:e[a].hasOwnProperty("texts")?e[a].texts[0]:"",txt2:e[a].hasOwnProperty("texts")?e[a].texts[1]:"",instruction:e[a].instruction}),f+=d,null!=e[a].media.mediaType&&("VOICE"===e[a].media.mediaType?(b=$("#qtVideoMedia").html(),c=Handlebars.compile(b),g=c({url:e[a].media.voiceUrl})):"PHOTO"===e[a].media.mediaType?(b=$("#qtphotoMedia").html(),c=Handlebars.compile(b),g=c({url:e[a].media.photoUrl})):"TEXT"===e[a].media.mediaType?(b=$("#qtTextMedia").html(),c=Handlebars.compile(b),g=c({engTxt:e[a].media.englishText,koTxt:e[a].media.koreanText})):g=void 0,i.push(g)),null!=e[a].answer.media.mediaType&&("VOICE"===e[a].answer.media.mediaType?(b=$("#qtVideoMedia").html(),c=Handlebars.compile(b),answerMedia=c({url:e[a].answer.media.voiceUrl})):"PHOTO"===e[a].answer.media.mediaType?(b=$("#qtphotoMedia").html(),c=Handlebars.compile(b),answerMedia=c({url:e[a].answer.media.photoUrl})):"TEXT"===e[a].answer.media.mediaType?(b=$("#qtTextMedia").html(),c=Handlebars.compile(b),answerMedia=c({engTxt:e[a].answer.media.englishText,koTxt:e[a].answer.media.koreanText})):answerMedia=void 0,h.push(answerMedia)),$(f).find(".btn-ko-en").parent().hide(),j.push(e[a].translate);if(this.personalQs&&this.personalQs.length>0){var l,m,n=1;for(a=0;a<this.personalQs.length;a++){if(l=void 0,this.personalQs[a].hasOwnProperty("anotherUser"))l=this.personalQs[a].anotherUser;else if(!this.personalQs[a].hasOwnProperty("userName"))continue;if("WRITING"===this.personalQs[a].type&&(this.setQuestionHTML(this.personalQs[a].correctionHtml),this.setBlanckedHTML(this.personalQs[a].correctionHtml),f+=this.setPersnalWritingTemp(this.personalQs[a],n,l),n++),"SPEAKING"!==this.personalQs[a].type||this.personalQs[a].curriculum){if("SPEAKING"===this.personalQs[a].type&&this.personalQs[a].curriculum){if(this.setQuestionHTML(this.personalQs[a].correctionHtml),this.setBlanckedHTML(this.personalQs[a].correctionHtml),this.personalQs[a].pronunciations)for(m=0;m<this.personalQs[a].pronunciations.length;m++)this.personalQs[a].pronunciations[m].sourceSrc="/speaking/"+this.personalQs[a].pronunciations[m].right;f+=this.setPersnalNewSpeakingTemp(this.personalQs[a],n,l),n++}}else{if(this.setQuestionHTML(this.personalQs[a].correctionHtml),this.setBlanckedHTML(this.personalQs[a].correctionHtml),this.personalQs[a].pronunciations)for(m=0;m<this.personalQs[a].pronunciations.length;m++)this.personalQs[a].pronunciations[m].sourceSrc="/speaking/"+this.personalQs[a].pronunciations[m].right;f+=this.setPersnalSpeakingTemp(this.personalQs[a],n,l),n++}}}for(k.append(f),a=0;a<j.length;a++)j[a]||k.find(".btn-ko-en").eq(a).parent().hide();k.find(".media").each(function(a){void 0!==i[a]&&$(this).append(i[a])}),k.find(".mediaAnswer").each(function(a){void 0!==h[a]&&$(this).append(h[a])}),k.byteCheck({obj:".txtBox",tar:".txtByte",maxCnt:150}),this.model.isComplete?$.proxy(this.answer(),this):$.proxy(this.grading(),this)},setQuestionHTML:function(a){this.questionHTML=$("<p>"+a+"</p>").find("span").each(function(a,b){var c=$(b);"underline"===c.css("text-decoration")&&c.css({color:"transparent","border-bottom":"2px solid #000"}),c.css("background-color")&&c.css("background-color","transparent")}).end().prop("outerHTML")},setBlanckedHTML:function(a){this.blankedHTML=$("<p>"+a+"</p>").find("span").each(function(a,b){var c=$(b);"underline"===c.css("text-decoration")&&c.css({color:"#ff4800","text-decoration":"none","background-color":"#ffd800"}),c.css("background-color")&&c.css("background-color","#ffd800")}).end().prop("outerHTML")},setPersnalWritingTemp:function(a,b,c){var d,e,f,b=parseInt(b,10);return d=$("#personalQs").html(),e=Handlebars.compile(d),f=e({id:a.id,order:"0"+(this.model.questions.length+b),title:"맞춤형 복습",instruction:a.instruction||"데이터가 비었습니다.",koreanText:a.koreanText||"데이터가 비었습니다.",userName:c?c:a.userName,answerText:a.answerText||"데이터가 비었습니다.",questionHTML:this.questionHTML,blankedHTML:this.blankedHTML,globalErrorDescription:a.globalErrorDescription||"빈 데이터"})},setPersnalSpeakingTemp:function(a,b,c){var d,e,f,b=parseInt(b,10);return d=$("#personalQs-speaking").html(),e=Handlebars.compile(d),f=e({id:a.id,order:"0"+(this.model.questions.length+b),title:"맞춤형 복습",instruction:a.instruction||"데이터가 비었습니다.",koreanText:a.koreanText||"데이터가 비었습니다.",userName:c?c:a.userName,questionHTML:this.questionHTML,userVoice:a.userVoice||"데이터가 비었습니다.",blankedHTML:this.blankedHTML,globalErrorDescription:a.globalErrorDescription||"빈 데이터",pronunciations:a.pronunciations})},setPersnalNewSpeakingTemp:function(a,b,c){var d,e,f,b=parseInt(b,10);d=$("#personalQs-speaking-new").html(),e=Handlebars.compile(d);var g=a.correctionHtml.split("ㅊ");return f=e({id:a.id,order:"0"+(this.model.questions.length+b),title:"맞춤형 복습",instruction:a.instruction||"데이터가 비었습니다.",koreanText:a.koreanText||"데이터가 비었습니다.",userName:c?c:a.userName,correctionHtml:a.correctionHtml,questionHTML:this.questionHTML,answer:view.review.makeAnswer(g),question:view.review.makeQuestion(g),userVoice:a.userVoice||"데이터가 비었습니다.",correctVoice:a.correctionVoice,correctionDescription:a.correctionDescription,blankedHTML:this.blankedHTML,globalErrorDescription:a.globalErrorDescription||"빈 데이터",pronunciations:a.pronunciations})},makeQuestion:function(a){return a.length<=3?a[0]+"__________"+a[2]:a.length>3&&a.length<7?a[0]+"_________"+a[2]+"_________"+a[4]:a.length>=7?a[0]+"_________"+a[2]+"_________"+a[4]+"_________"+a[6]:void 0},makeAnswer:function(a){return a.length<=3?a[1]:a.length>3&&a.length<7?a[1]+", "+a[3]:a.length>=7?a[1]+", "+a[3]+", "+a[5]:void 0},grading:function(){this.resolvedIdx=0,this.post=$("#reviewPost"),this.section=this.post.parent(),this.postCard=this.post.find(".post-card"),this.postWraper=$(".flickingWrap"),this.button=this.post.find(".user-select-value"),this.inputTxt=this.post.find(".single-word"),this.textarea=this.post.find(".question textarea"),this.completeCheck=this.post.find(".btn-icon-checked"),this.nextBtn=this.post.find(".btn-next-q"),this.submitBtn=$("#review-submit"),this.btnOx=this.post.find(".btn-ox"),this.flagBtn=this.post.find(".btn-true-false"),this.speechBtn=this.post.find(".btn-speak"),this.speakingBtn=this.post.find(".speak-box .btn-speak"),this.completeCheck.on("click",$.proxy(this.userGrading,this)),this.nextBtn.on("click",$.proxy(this.showNextQuestion,this)),this.submitBtn.on("click",$.proxy(this.submit,this)),this.btnOx.on("click",$.proxy(this.keepClass,this)),this.flagBtn.on("click",$.proxy(this.keepClass,this)),this.speechBtn.on("click",$.proxy(this.textToSpeech,this)),this.speakingBtn.on("click",$.proxy(this.audioPlay,this)),this.nextBtn.parent().hide();var a=0;for(a=0;a<this.postCard.length;a++)0!=a&&this.postCard.eq(a).hide()},audioPlay:function(a){var b=$(a.currentTarget).next()[0];b.volume=1,b.play()},textToSpeech:function(a){var b=new Audio,c=$(a.target).prev();b.setAttribute("src",c.find("source").attr("src")),b.volume=1,b.load(),b.play()},keepClass:function(a){var b=$(a.currentTarget);b.parent().find(">button").removeClass("on"),b.addClass("on")},userGrading:function(a){a.preventDefault();var b,c=$(a.target).closest(".question"),d=c.next(),e=c.attr("data-type"),f=c.find(".user-right"),g="",h="";if("REVIEW"===e&&(b=c.find(".single-word"),0!=b.length&&(h=b.val().toLowerCase().trim())),"SUBJECTIVE"===e&&(b=c.find("textarea"),h=b.val().toLowerCase().trim()),c.attr("data-user-answer",h),g=c.attr("data-answer").toLowerCase().trim(),!h)return void alert("문제를 풀어 주세요!");if("REVIEW"===e&&(h=h.replace(/ /g,""),g=g.match(/[a-zA-Z]+/g)[0],h=h.match(/[a-zA-Z]+/g)[0]),g==h?(f.eq(1).hide(),c.attr("data-user-right")||c.attr("data-user-right",!0)):(f.eq(0).hide(),c.attr("data-user-right")||c.attr("data-user-right",!1)),c.find(".result").show(),$(a.currentTarget).hide(),this.resolvedIdx!==this.postCard.length-1){d.show();var i=this;setTimeout(function(){$(".flickingWrap").height(i.post.height()+30)},500)}else this.submitBtn.parent().removeClass("btn-complete-show").addClass("btn-complete-hide"),this.section.data("solvingEnd",!0),this.submitBtn.show(),this.submitBtn.parent().removeClass("btn-complete-hide").addClass("btn-complete-show"),this.postWraper.height(this.post.height()+30),$(".btn-bottom").trigger("click");disable.completionPost(a)},showNextQuestion:function(a){a.preventDefault();var b,c,d=this.postCard.eq(this.resolvedIdx).attr("data-type");if("SUBJECTIVE"===d){if(b=this.postCard.eq(this.resolvedIdx),c=b.find(".user-select-value"),!c.hasClass("on"))return this.section.data("solvingEnd",!1),void alert("스스로 채점을 해주세요!");var e=b.find(".on").attr("data-user-value");"true"==e?b.attr("data-user-right",!0):b.attr("data-user-right",!1)}this.nextBtn.eq(this.resolvedIdx).parent().hide(),this.resolvedIdx++,_band.drawInfo.model.resolvedIndex=this.resolvedIdx,scroll.gotoNext(),this.resolvedIdx+1===this.postCard.length&&(this.nextBtn.parent().hide(),this.nextBtn.off("click",this.showNextQuestion))},qsValidation:function(){var a=[],b=!0;return this.postCard.each(function(c,d){var e,f=$(d);if(a.push({questionId:f.attr("data-qid"),answer:f.attr("data-user-answer"),right:f.attr("data-user-right")}),"SUBJECTIVE"===f.attr("data-type")){if(e=f.find(".on").attr("data-user-value"),f.attr("data-user-right",e),a[c].right=e,!f.find(".user-select-value").hasClass("on"))return f.closest("section").data("solvingEnd",!1),void(b=!1);f.closest("section").data("solvingEnd",!0),b=!0}}),b?this.answerInfo=a:alert("스스로 채점을 해주세요!"),b},submit:function(a){var b=_band.info.model,c=b.lessonId,d=$("#loadingImg"),e=$("#trialToCharge"),f=this.submitBtn;if(a.preventDefault(),this.qsValidation()){if("FREE"===b.paymentType)return e.find(".correction_go > img").attr("src","/dist/images/icon/correction_go_pop2.png"),e.showModal(),f.hide(),void view.info.setCompleatePost("reviewPostComplete");d.show(),$.ajax({url:URL+"/lesson/reviewPost/"+c,dataType:"json",contentType:"application/json",data:JSON.stringify(this.answerInfo),type:"POST",success:function(a){d.hide(),"200"===a.code?(f.hide(),view.info.setCompleatePost("reviewPostComplete"),view.info.setModal(a.result),scroll.gotoTop()):alert("전송실패\n다시 전송해주세요")}})}},answer:function(){var a=$("#reviewPost"),b=this.model.answerSet,c=a.find(".btn-next-q"),d=a.find(".btn-icon-checked"),e=a.find(".question"),f=a.find(".result"),g=(a.find(".post-card"),a.find(".btn-speak")),h=a.find(".speak-box .btn-speak"),i=0;for(i=0;i<b.length;i++){var j,k=e.eq(i).find(".btn-true-false"),l=e.eq(i).find(".user-right");(e.eq(i).attr("data-qid")!=b[i].questionId||(j=e.eq(i),e.eq(i).attr("data-type")))&&("REVIEW"==j.attr("data-type")&&(j.find(".single-word").attr({placeholder:"",value:b[i].answer,readonly:!0}),b[i].right?l.eq(1).hide():l.eq(0).hide()),"SUBJECTIVE"==j.attr("data-type")&&(j.find(".txtBox").attr({placeholder:b[i].answer,readonly:!0}).addClass("complete"),b[i].right?k.eq(0).addClass("on"):k.eq(1).addClass("on")))}c.hide(),d.hide(),f.show(),a.find(".txtByte").remove(),disable.disablePost(a),g.on("click",$.proxy(this.textToSpeech,this)),h.on("click",$.proxy(this.audioPlay,this))}};